var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};
$jscomp.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,e){c=b(c,d);e&&Reflect.setPrototypeOf(c,e.prototype);return c}}return function(c,d,e){void 0===e&&(e=c);e=$jscomp.objectCreate(e.prototype||Object.prototype);return Function.prototype.apply.call(c,e,d)||
e}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(a){return $jscomp.construct},"es6","es3");
$jscomp.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(e){return!1}}}return null},"es6","es5");$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var g=0;g<f&&c<e;)if(d[c++]!=b[g++])return!1;return g>=f}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,f){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(b){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");OV={};OV.TaskRunner=function(){this.callbacks=this.current=this.count=null};OV.TaskRunner.prototype.Run=function(a,b){this.count=a;this.current=0;this.callbacks=b;0===a?this.TaskReady():this.RunOnce()};OV.TaskRunner.prototype.RunOnce=function(){var a=this;setTimeout(function(){a.callbacks.runTask(a.current,a.TaskReady.bind(a))},0)};OV.TaskRunner.prototype.TaskReady=function(){this.current+=1;if(this.current<this.count)this.RunOnce();else if(this.callbacks.onReady)this.callbacks.onReady()};
OV.RunTaskAsync=function(a){setTimeout(function(){a()},0)};OV.Eps=1E-8;OV.RadDeg=57.29577951308232;OV.DegRad=.017453292519943;OV.IsZero=function(a){return Math.abs(a)<OV.Eps};OV.IsLower=function(a,b){return b-a>OV.Eps};OV.IsGreater=function(a,b){return a-b>OV.Eps};OV.IsEqual=function(a,b){return Math.abs(b-a)<OV.Eps};OV.IsPositive=function(a){return a>OV.Eps};OV.IsNegative=function(a){return a<-OV.Eps};OV.Direction={X:1,Y:2,Z:3};OV.Coord2D=function(a,b){this.x=a;this.y=b};OV.Coord2D.prototype.Clone=function(){return new OV.Coord2D(this.x,this.y)};OV.CoordIsEqual2D=function(a,b){return OV.IsEqual(a.x,b.x)&&OV.IsEqual(a.y,b.y)};OV.AddCoord2D=function(a,b){return new OV.Coord2D(a.x+b.x,a.y+b.y)};OV.SubCoord2D=function(a,b){return new OV.Coord2D(a.x-b.x,a.y-b.y)};OV.CoordDistance2D=function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))};OV.Coord3D=function(a,b,c){this.x=a;this.y=b;this.z=c};OV.Coord3D.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};OV.Coord3D.prototype.MultiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};OV.Coord3D.prototype.Normalize=function(){var a=this.Length();0<a&&this.MultiplyScalar(1/a);return this};OV.Coord3D.prototype.Offset=function(a,b){a=a.Clone().Normalize();this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this};
OV.Coord3D.prototype.Rotate=function(a,b,c){var d=a.Clone().Normalize();a=d.x;var e=d.y;d=d.z;var f=this.x-c.x,g=this.y-c.y,h=this.z-c.z,k=Math.sin(b);b=Math.cos(b);this.x=-a*(-a*f-e*g-d*h)*(1-b)+f*b+(-d*g+e*h)*k;this.y=-e*(-a*f-e*g-d*h)*(1-b)+g*b+(d*f-a*h)*k;this.z=-d*(-a*f-e*g-d*h)*(1-b)+h*b+(-e*f+a*g)*k;this.x+=c.x;this.y+=c.y;this.z+=c.z;return this};OV.Coord3D.prototype.Clone=function(){return new OV.Coord3D(this.x,this.y,this.z)};
OV.CoordIsEqual3D=function(a,b){return OV.IsEqual(a.x,b.x)&&OV.IsEqual(a.y,b.y)&&OV.IsEqual(a.z,b.z)};OV.AddCoord3D=function(a,b){return new OV.Coord3D(a.x+b.x,a.y+b.y,a.z+b.z)};OV.SubCoord3D=function(a,b){return new OV.Coord3D(a.x-b.x,a.y-b.y,a.z-b.z)};OV.CoordDistance3D=function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)+(a.z-b.z)*(a.z-b.z))};
OV.VectorAngle3D=function(a,b){a=a.Clone().Normalize();b=b.Clone().Normalize();if(OV.CoordIsEqual3D(a,b))return 0;b=OV.DotVector3D(a,b);return Math.acos(b)};OV.DotVector3D=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};OV.CrossVector3D=function(a,b){var c=new OV.Coord3D(0,0,0);c.x=a.y*b.z-a.z*b.y;c.y=a.z*b.x-a.x*b.z;c.z=a.x*b.y-a.y*b.x;return c};OV.VectorLength3D=function(a,b,c){return Math.sqrt(a*a+b*b+c*c)};OV.Matrix=function(a){this.matrix=null;void 0!==a&&null!==a&&(this.matrix=a)};OV.Matrix.prototype.IsValid=function(){return null!==this.matrix};OV.Matrix.prototype.Set=function(a){this.matrix=a;return this};OV.Matrix.prototype.Get=function(){return this.matrix};
OV.Matrix.prototype.Clone=function(){return new OV.Matrix([this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],this.matrix[6],this.matrix[7],this.matrix[8],this.matrix[9],this.matrix[10],this.matrix[11],this.matrix[12],this.matrix[13],this.matrix[14],this.matrix[15]])};OV.Matrix.prototype.CreateIdentity=function(){this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this};
OV.Matrix.prototype.IsIdentity=function(){for(var a=(new OV.Matrix).CreateIdentity().Get(),b=0;16>b;b++)if(!OV.IsEqual(this.matrix[b],a[b]))return!1;return!0};OV.Matrix.prototype.CreateTranslation=function(a,b,c){this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,a,b,c,1];return this};OV.Matrix.prototype.CreateRotation=function(a,b,c,d){var e=a+a,f=b+b,g=c+c,h=a*e,k=a*f;a*=g;var l=b*f;b*=g;c*=g;e*=d;f*=d;d*=g;this.matrix=[1-(l+c),k+d,a-f,0,k-d,1-(h+c),b+e,0,a+f,b-e,1-(h+l),0,0,0,0,1];return this};
OV.Matrix.prototype.CreateScale=function(a,b,c){this.matrix=[a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1];return this};OV.Matrix.prototype.ComposeTRS=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];b=c[0];var h=c[1];c=c[2];var k=d+d,l=e+e,m=f+f,n=d*k,q=d*l;d*=m;var p=e*l;e*=m;f*=m;k*=g;l*=g;g*=m;this.matrix=[(1-(p+f))*b,(q+g)*b,(d-l)*b,0,(q-g)*h,(1-(n+f))*h,(e+k)*h,0,(d+l)*c,(e-k)*c,(1-(n+p))*c,0,a[0],a[1],a[2],1];return this};
OV.Matrix.prototype.DecomposeTRS=function(){var a=[this.matrix[12],this.matrix[13],this.matrix[14]],b=OV.VectorLength3D(this.matrix[0],this.matrix[1],this.matrix[2]),c=OV.VectorLength3D(this.matrix[4],this.matrix[5],this.matrix[6]),d=OV.VectorLength3D(this.matrix[8],this.matrix[9],this.matrix[10]),e=this.Determinant();OV.IsNegative(e)&&(b*=-1);e=[b,c,d];var f=this.matrix[0]/b,g=this.matrix[4]/c,h=this.matrix[8]/d,k=this.matrix[1]/b,l=this.matrix[5]/c,m=this.matrix[9]/d;b=this.matrix[2]/b;c=this.matrix[6]/
c;d=this.matrix[10]/d;var n=f+l+d;0<n?(f=2*Math.sqrt(n+1),g=[(c-m)/f,(h-b)/f,(k-g)/f,.25*f]):f>l&&f>d?(f=2*Math.sqrt(1+f-l-d),g=[.25*f,(g+k)/f,(h+b)/f,(c-m)/f]):l>d?(f=2*Math.sqrt(1+l-f-d),g=[(g+k)/f,.25*f,(m+c)/f,(h-b)/f]):(f=2*Math.sqrt(1+d-f-l),g=[(h+b)/f,(m+c)/f,.25*f,(k-g)/f]);return{translation:a,rotation:g,scale:e}};
OV.Matrix.prototype.Determinant=function(){var a=this.matrix[0],b=this.matrix[1],c=this.matrix[2],d=this.matrix[3],e=this.matrix[4],f=this.matrix[5],g=this.matrix[6],h=this.matrix[7],k=this.matrix[8],l=this.matrix[9],m=this.matrix[10],n=this.matrix[11],q=this.matrix[12],p=this.matrix[13],r=this.matrix[14],t=this.matrix[15];return(a*f-b*e)*(m*t-n*r)-(a*g-c*e)*(l*t-n*p)+(a*h-d*e)*(l*r-m*p)+(b*g-c*f)*(k*t-n*q)-(b*h-d*f)*(k*r-m*q)+(c*h-d*g)*(k*p-l*q)};
OV.Matrix.prototype.Invert=function(){var a=this.matrix[0],b=this.matrix[1],c=this.matrix[2],d=this.matrix[3],e=this.matrix[4],f=this.matrix[5],g=this.matrix[6],h=this.matrix[7],k=this.matrix[8],l=this.matrix[9],m=this.matrix[10],n=this.matrix[11],q=this.matrix[12],p=this.matrix[13],r=this.matrix[14],t=this.matrix[15],w=a*f-b*e,v=a*g-c*e,u=a*h-d*e,y=b*g-c*f,x=b*h-d*f,B=c*h-d*g,z=k*p-l*q,A=k*r-m*q,C=k*t-n*q,E=l*r-m*p,D=l*t-n*p,G=m*t-n*r,F=w*G-v*D+u*E+y*C-x*A+B*z;return OV.IsEqual(F,0)?null:new OV.Matrix([(f*
G-g*D+h*E)/F,(c*D-b*G-d*E)/F,(p*B-r*x+t*y)/F,(m*x-l*B-n*y)/F,(g*C-e*G-h*A)/F,(a*G-c*C+d*A)/F,(r*u-q*B-t*v)/F,(k*B-m*u+n*v)/F,(e*D-f*C+h*z)/F,(b*C-a*D-d*z)/F,(q*x-p*u+t*w)/F,(l*u-k*x-n*w)/F,(f*A-e*E-g*z)/F,(a*E-b*A+c*z)/F,(p*v-q*y-r*w)/F,(k*y-l*v+m*w)/F])};
OV.Matrix.prototype.MultiplyVector=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return[b*this.matrix[0]+c*this.matrix[4]+d*this.matrix[8]+a*this.matrix[12],b*this.matrix[1]+c*this.matrix[5]+d*this.matrix[9]+a*this.matrix[13],b*this.matrix[2]+c*this.matrix[6]+d*this.matrix[10]+a*this.matrix[14],b*this.matrix[3]+c*this.matrix[7]+d*this.matrix[11]+a*this.matrix[15]]};
OV.Matrix.prototype.MultiplyMatrix=function(a){var b=this.matrix[0],c=this.matrix[1],d=this.matrix[2],e=this.matrix[3],f=this.matrix[4],g=this.matrix[5],h=this.matrix[6],k=this.matrix[7],l=this.matrix[8],m=this.matrix[9],n=this.matrix[10],q=this.matrix[11],p=this.matrix[12],r=this.matrix[13],t=this.matrix[14],w=this.matrix[15],v=a.matrix[0],u=a.matrix[1],y=a.matrix[2],x=a.matrix[3],B=a.matrix[4],z=a.matrix[5],A=a.matrix[6],C=a.matrix[7],E=a.matrix[8],D=a.matrix[9],G=a.matrix[10],F=a.matrix[11],H=
a.matrix[12],I=a.matrix[13],J=a.matrix[14];a=a.matrix[15];return new OV.Matrix([b*v+c*B+d*E+e*H,b*u+c*z+d*D+e*I,b*y+c*A+d*G+e*J,b*x+c*C+d*F+e*a,f*v+g*B+h*E+k*H,f*u+g*z+h*D+k*I,f*y+g*A+h*G+k*J,f*x+g*C+h*F+k*a,l*v+m*B+n*E+q*H,l*u+m*z+n*D+q*I,l*y+m*A+n*G+q*J,l*x+m*C+n*F+q*a,p*v+r*B+t*E+w*H,p*u+r*z+t*D+w*I,p*y+r*A+t*G+w*J,p*x+r*C+t*F+w*a])};OV.Transformation=function(a){void 0!==a&&null!==a?this.matrix=a:(this.matrix=new OV.Matrix,this.matrix.CreateIdentity())};OV.Transformation.prototype.SetMatrix=function(a){this.matrix=a;return this};OV.Transformation.prototype.GetMatrix=function(){return this.matrix};OV.Transformation.prototype.IsIdentity=function(){return this.matrix.IsIdentity()};OV.Transformation.prototype.AppendMatrix=function(a){this.matrix=this.matrix.MultiplyMatrix(a);return this};
OV.Transformation.prototype.TransformCoord3D=function(a){a=this.matrix.MultiplyVector([a.x,a.y,a.z,1]);return new OV.Coord3D(a[0],a[1],a[2])};OV.BezierTweenFunction=function(a,b,c){b/=c;return a*b*b*(3-2*b)};OV.LinearTweenFunction=function(a,b,c){return b*a/c};OV.ParabolicTweenFunction=function(a,b,c){b/=c;c=b*b;return c/(2*(c-b)+1)*a};OV.TweenCoord3D=function(a,b,c,d){var e=OV.SubCoord3D(b,a).Normalize();b=OV.CoordDistance3D(a,b);for(var f=[],g=0;g<c;g++){var h=d(b,g,c-1);f.push(a.Clone().Offset(e,h))}return f};OV.BinaryReader=function(a,b){this.arrayBuffer=a;this.dataView=new DataView(a);this.isLittleEndian=b;this.position=0};OV.BinaryReader.prototype.GetPosition=function(){return this.position};OV.BinaryReader.prototype.SetPosition=function(a){this.position=a};OV.BinaryReader.prototype.GetByteLength=function(){return this.arrayBuffer.byteLength};OV.BinaryReader.prototype.Skip=function(a){this.position+=a};OV.BinaryReader.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength};
OV.BinaryReader.prototype.ReadArrayBuffer=function(a){var b=new Uint8Array(this.arrayBuffer),c=new ArrayBuffer(a),d=new Uint8Array(c);b=b.subarray(this.position,this.position+a);d.set(b,0);this.position+=a;return c};OV.BinaryReader.prototype.ReadBoolean8=function(){var a=this.dataView.getInt8(this.position);this.position+=1;return a?!0:!1};OV.BinaryReader.prototype.ReadCharacter8=function(){var a=this.dataView.getInt8(this.position);this.position+=1;return a};
OV.BinaryReader.prototype.ReadUnsignedCharacter8=function(){var a=this.dataView.getUint8(this.position);this.position+=1;return a};OV.BinaryReader.prototype.ReadInteger16=function(){var a=this.dataView.getInt16(this.position,this.isLittleEndian);this.position+=2;return a};OV.BinaryReader.prototype.ReadUnsignedInteger16=function(){var a=this.dataView.getUint16(this.position,this.isLittleEndian);this.position+=2;return a};
OV.BinaryReader.prototype.ReadInteger32=function(){var a=this.dataView.getInt32(this.position,this.isLittleEndian);this.position+=4;return a};OV.BinaryReader.prototype.ReadUnsignedInteger32=function(){var a=this.dataView.getUint32(this.position,this.isLittleEndian);this.position+=4;return a};OV.BinaryReader.prototype.ReadFloat32=function(){var a=this.dataView.getFloat32(this.position,this.isLittleEndian);this.position+=4;return a};
OV.BinaryReader.prototype.ReadDouble64=function(){var a=this.dataView.getFloat64(this.position,this.isLittleEndian);this.position+=8;return a};OV.BinaryWriter=function(a,b){this.arrayBuffer=new ArrayBuffer(a);this.dataView=new DataView(this.arrayBuffer);this.isLittleEndian=b;this.position=0};OV.BinaryWriter.prototype.GetPosition=function(){return this.position};OV.BinaryWriter.prototype.SetPosition=function(a){this.position=a};OV.BinaryWriter.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength};OV.BinaryWriter.prototype.GetBuffer=function(){return this.arrayBuffer};
OV.BinaryWriter.prototype.WriteArrayBuffer=function(a){var b=new Uint8Array(a);(new Uint8Array(this.arrayBuffer)).set(b,this.position);this.position+=a.byteLength};OV.BinaryWriter.prototype.WriteBoolean8=function(a){this.dataView.setInt8(this.position,a?1:0);this.position+=1};OV.BinaryWriter.prototype.WriteCharacter8=function(a){this.dataView.setInt8(this.position,a);this.position+=1};
OV.BinaryWriter.prototype.WriteUnsignedCharacter8=function(a){this.dataView.setUint8(this.position,a);this.position+=1};OV.BinaryWriter.prototype.WriteInteger16=function(a){this.dataView.setInt16(this.position,a,this.isLittleEndian);this.position+=2};OV.BinaryWriter.prototype.WriteUnsignedInteger16=function(a){this.dataView.setUint16(this.position,a,this.isLittleEndian);this.position+=2};
OV.BinaryWriter.prototype.WriteInteger32=function(a){this.dataView.setInt32(this.position,a,this.isLittleEndian);this.position+=4};OV.BinaryWriter.prototype.WriteUnsignedInteger32=function(a){this.dataView.setUint32(this.position,a,this.isLittleEndian);this.position+=4};OV.BinaryWriter.prototype.WriteFloat32=function(a){this.dataView.setFloat32(this.position,a,this.isLittleEndian);this.position+=4};
OV.BinaryWriter.prototype.WriteDouble64=function(a){this.dataView.setFloat64(this.position,a,this.isLittleEndian);this.position+=8};OV.TextWriter=function(){this.text="";this.indentation=0};OV.TextWriter.prototype.GetText=function(){return this.text};OV.TextWriter.prototype.Indent=function(a){this.indentation+=a};OV.TextWriter.prototype.WriteArrayLine=function(a){this.WriteLine(a.join(" "))};OV.TextWriter.prototype.WriteLine=function(a){this.WriteIndentation();this.Write(a+"\n")};OV.TextWriter.prototype.WriteIndentation=function(){for(var a=0;a<this.indentation;a++)this.Write("  ")};
OV.TextWriter.prototype.Write=function(a){this.text+=a};OV.ArrayBufferToUtf8String=function(a){return(new TextDecoder("utf-8")).decode(a)};OV.ArrayBufferToAsciiString=function(a){var b="";a=new Uint8Array(a);for(var c=0;c<a.byteLength;c++)b+=String.fromCharCode(a[c]);return b};OV.AsciiStringToArrayBuffer=function(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d<a.length;d++)c[d]=a.charCodeAt(d);return b};OV.Utf8StringToArrayBuffer=function(a){return(new TextEncoder).encode(a)};
OV.Base64DataURIToArrayBuffer=function(a){if(!a.startsWith("data:"))return null;var b=a.indexOf(";");if(-1===b)return null;var c=a.indexOf(",");if(-1===c)return null;b=a.substr(5,b-5);a=atob(a.substr(c+1));c=new ArrayBuffer(a.length);for(var d=new Uint8Array(c),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return{mimeType:b,buffer:c}};OV.CreateObjectUrl=function(a){a=new Blob([a]);return URL.createObjectURL(a)};OV.CreateObjectUrlWithMimeType=function(a,b){a=new Blob([a],{type:b});return URL.createObjectURL(a)};
OV.RevokeObjectUrl=function(a){URL.revokeObjectURL(a)};OV.FileSource={Url:1,File:2};OV.FileFormat={Text:1,Binary:2};OV.GetFileName=function(a){var b=a.lastIndexOf("/");-1===b&&(b=a.lastIndexOf("\\"));var c=a;-1!==b&&(c=a.substr(b+1));return decodeURI(c)};OV.GetFileExtension=function(a){var b=a.lastIndexOf(".");return-1===b?"":a.substr(b+1)};
OV.RequestUrl=function(a,b,c){function d(){c.error&&c.error();c.complete&&c.complete()}var e=new XMLHttpRequest;e.open("GET",a,!0);if(b===OV.FileFormat.Text)e.responseType="text";else if(b===OV.FileFormat.Binary)e.responseType="arraybuffer";else{d();return}e.onload=function(){if(200===e.status){var f=e.response;c.success&&c.success(f);c.complete&&c.complete()}else d()};e.onerror=function(){d()};e.send(null)};
OV.ReadFile=function(a,b,c){function d(){c.error&&c.error();c.complete&&c.complete()}var e=new FileReader;e.onloadend=function(f){f.target.readyState===FileReader.DONE&&(c.success&&c.success(f.target.result),c.complete&&c.complete())};e.onerror=function(){d()};b===OV.FileFormat.Text?e.readAsText(a):b===OV.FileFormat.Binary?e.readAsArrayBuffer(a):d()};OV.SRGBToLinear=function(a){return.04045>a?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)};OV.LinearToSRGB=function(a){return.0031308>a?12.92*a:1.055*Math.pow(a,.41666)-.055};OV.Color=function(a,b,c){this.r=a;this.g=b;this.b=c};OV.Color.prototype.Set=function(a,b,c){this.r=a;this.g=b;this.b=c};OV.Color.prototype.Clone=function(){return new OV.Color(this.r,this.g,this.b)};
OV.TextureMap=function(){this.buffer=this.url=this.name=null;this.offset=new OV.Coord2D(0,0);this.scale=new OV.Coord2D(1,1);this.rotation=0};OV.TextureMap.prototype.IsValid=function(){return null!==this.name&&null!==this.url&&null!==this.buffer};OV.TextureMap.prototype.HasTransformation=function(){return OV.CoordIsEqual2D(this.offset,new OV.Coord2D(0,0))&&OV.CoordIsEqual2D(this.scale,new OV.Coord2D(1,1))&&OV.IsEqual(this.rotation,0)?!1:!0};
OV.TextureMap.prototype.Clone=function(){var a=new OV.TextureMap;a.name=this.name;a.url=this.url;a.buffer=this.buffer;a.offset=this.offset.Clone();a.scale=this.scale.Clone();a.rotation=this.rotation;return a};
OV.Material=function(){this.name="";this.ambient=new OV.Color(0,0,0);this.diffuse=new OV.Color(0,0,0);this.specular=new OV.Color(0,0,0);this.emissive=new OV.Color(0,0,0);this.shininess=0;this.opacity=1;this.emissiveMap=this.normalMap=this.bumpMap=this.specularMap=this.diffuseMap=null;this.alphaTest=0;this.multiplyDiffuseMap=this.transparent=!1};
OV.Material.prototype.EnumerateTextureMaps=function(a){null!==this.diffuseMap&&a(this.diffuseMap);null!==this.specularMap&&a(this.specularMap);null!==this.bumpMap&&a(this.bumpMap);null!==this.normalMap&&a(this.normalMap);null!==this.emissiveMap&&a(this.emissiveMap)};
OV.Material.prototype.Clone=function(){var a=new OV.Material;a.name=this.name;a.ambient=this.ambient.Clone();a.diffuse=this.diffuse.Clone();a.specular=this.specular.Clone();a.emissive=this.emissive.Clone();a.shininess=this.shininess;a.opacity=this.opacity;a.diffuseMap=this.CloneTextureMap(this.diffuseMap);a.specularMap=this.CloneTextureMap(this.specularMap);a.bumpMap=this.CloneTextureMap(this.bumpMap);a.normalMap=this.CloneTextureMap(this.normalMap);a.emissiveMap=this.CloneTextureMap(this.emissiveMap);
a.alphaTest=this.alphaTest;a.transparent=this.transparent;a.multiplyDiffuseMap=this.multiplyDiffuseMap;return a};OV.Material.prototype.CloneTextureMap=function(a){return null===a?null:a.Clone()};OV.Triangle=function(a,b,c){this.v0=a;this.v1=b;this.v2=c;this.curve=this.mat=this.u2=this.u1=this.u0=this.n2=this.n1=this.n0=null};OV.Triangle.prototype.HasVertices=function(){return null!==this.v0&&null!==this.v1&&null!==this.v2};
OV.Triangle.prototype.HasNormals=function(){return null!==this.n0&&null!==this.n1&&null!==this.n2};OV.Triangle.prototype.HasTextureUVs=function(){return null!==this.u0&&null!==this.u1&&null!==this.u2};OV.Triangle.prototype.SetVertices=function(a,b,c){this.v0=a;this.v1=b;this.v2=c;return this};OV.Triangle.prototype.SetNormals=function(a,b,c){this.n0=a;this.n1=b;this.n2=c;return this};OV.Triangle.prototype.SetTextureUVs=function(a,b,c){this.u0=a;this.u1=b;this.u2=c;return this};
OV.Triangle.prototype.SetMaterial=function(a){this.mat=a;return this};OV.Triangle.prototype.SetCurve=function(a){this.curve=a;return this};OV.Triangle.prototype.Clone=function(){var a=new OV.Triangle(this.v0,this.v1,this.v2);a.SetNormals(this.n0,this.n1,this.n2);a.SetTextureUVs(this.u0,this.u1,this.u2);a.SetMaterial(this.mat);a.SetCurve(this.curve);return a};
OV.ColorToHexString=function(a){function b(e){for(e=parseInt(e,10).toString(16);2>e.length;)e="0"+e;return e}var c=b(a.r),d=b(a.g);a=b(a.b);return c+d+a};OV.HexStringToColor=function(a){if(6!==a.length)return null;var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16);a=parseInt(a.substr(4,2),16);return new OV.Color(b,c,a)};OV.ColorIsEqual=function(a,b){return a.r===b.r&&a.g===b.g&&a.b===b.b};OV.Mesh=function(){this.name="";this.vertices=[];this.normals=[];this.uvs=[];this.triangles=[]};OV.Mesh.prototype.GetName=function(){return this.name};OV.Mesh.prototype.SetName=function(a){this.name=a};OV.Mesh.prototype.VertexCount=function(){return this.vertices.length};OV.Mesh.prototype.NormalCount=function(){return this.normals.length};OV.Mesh.prototype.TextureUVCount=function(){return this.uvs.length};OV.Mesh.prototype.TriangleCount=function(){return this.triangles.length};
OV.Mesh.prototype.AddVertex=function(a){this.vertices.push(a);return this.vertices.length-1};OV.Mesh.prototype.SetVertex=function(a,b){this.vertices[a]=b};OV.Mesh.prototype.GetVertex=function(a){return this.vertices[a]};OV.Mesh.prototype.AddNormal=function(a){this.normals.push(a);return this.normals.length-1};OV.Mesh.prototype.SetNormal=function(a,b){this.normals[a]=b};OV.Mesh.prototype.GetNormal=function(a){return this.normals[a]};
OV.Mesh.prototype.AddTextureUV=function(a){this.uvs.push(a);return this.uvs.length-1};OV.Mesh.prototype.SetTextureUV=function(a,b){this.uvs[a]=b};OV.Mesh.prototype.GetTextureUV=function(a){return this.uvs[a]};OV.Mesh.prototype.AddTriangle=function(a){this.triangles.push(a);return this.triangles.length-1};OV.Mesh.prototype.GetTriangle=function(a){return this.triangles[a]};OV.MeshPrimitiveBuffer=function(){this.indices=[];this.vertices=[];this.normals=[];this.uvs=[];this.material=null};OV.MeshPrimitiveBuffer.prototype.GetBounds=function(){for(var a=[Infinity,Infinity,Infinity],b=[-Infinity,-Infinity,-Infinity],c=0;c<this.vertices.length/3;c++)for(var d=0;3>d;d++)a[d]=Math.min(a[d],this.vertices[3*c+d]),b[d]=Math.max(b[d],this.vertices[3*c+d]);return{min:a,max:b}};
OV.MeshPrimitiveBuffer.prototype.GetByteLength=function(a,b){return this.indices.length*a+(this.vertices.length+this.normals.length+this.uvs.length)*b};OV.MeshBuffer=function(){this.primitives=[]};OV.MeshBuffer.prototype.PrimitiveCount=function(){return this.primitives.length};OV.MeshBuffer.prototype.GetPrimitive=function(a){return this.primitives[a]};OV.MeshBuffer.prototype.GetByteLength=function(a,b){for(var c=0,d=0;d<this.primitives.length;d++)c+=this.primitives[d].GetByteLength(a,b);return c};
OV.ConvertMeshToMeshBuffer=function(a){function b(k,l,m,n,q,p){function r(v,u,y,x,B){var z=0<v.TextureUVCount();u=v.GetVertex(u);y=v.GetNormal(y);var A=B.vertices.length/3;B.indices.push(A);B.vertices.push(u.x,u.y,u.z);B.normals.push(y.x,y.y,y.z);v=null!==x?v.GetTextureUV(x):z?new OV.Coord2D(0,0):null;null!==v&&B.uvs.push(v.x,v.y);return{index:A,normal:y,uv:v}}function t(v,u,y,x){for(var B=0;B<u.length;B++){var z=u[B],A=v.GetNormal(y);A=OV.CoordIsEqual3D(z.normal,A);if(null===z.uv&&null===x)var C=
!0;else C=null!==x?v.GetTextureUV(x):new OV.Coord2D(0,0),C=OV.CoordIsEqual2D(z.uv,C);if(A&&C)return z}return null}var w=p[l];void 0===w?(w=r(k,l,m,n,q),p[l]=[w]):(p=t(k,w,m,n),null!==p?q.indices.push(p.index):(l=r(k,l,m,n,q),w.push(l)))}var c=new OV.MeshBuffer,d=a.TriangleCount();if(0===d)return null;for(var e=[],f=0;f<d;f++)e.push(f);e.sort(function(k,l){k=a.GetTriangle(k);l=a.GetTriangle(l);return k.mat-l.mat});f=d=null;for(var g=0;g<e.length;g++){var h=a.GetTriangle(e[g]);if(null===d||d.material!==
h.mat)d=new OV.MeshPrimitiveBuffer,d.material=h.mat,f={},c.primitives.push(d);b(a,h.v0,h.n0,h.u0,d,f);b(a,h.v1,h.n1,h.u1,d,f);b(a,h.v2,h.n2,h.u2,d,f)}return c};OV.Model=function(){this.name="";this.materials=[];this.meshes=[]};OV.Model.prototype.GetName=function(){return this.name};OV.Model.prototype.SetName=function(a){this.name=a};OV.Model.prototype.MaterialCount=function(){return this.materials.length};OV.Model.prototype.MeshCount=function(){return this.meshes.length};OV.Model.prototype.VertexCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].VertexCount();return a};
OV.Model.prototype.NormalCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].NormalCount();return a};OV.Model.prototype.TextureUVCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].TextureUVCount();return a};OV.Model.prototype.TriangleCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].TriangleCount();return a};OV.Model.prototype.AddMaterial=function(a){this.materials.push(a);return this.materials.length-1};
OV.Model.prototype.GetMaterial=function(a){return this.materials[a]};OV.Model.prototype.AddMesh=function(a){this.meshes.push(a);return this.meshes.length-1};OV.Model.prototype.AddMeshToIndex=function(a,b){this.meshes.splice(b,0,a);return b};OV.Model.prototype.RemoveMesh=function(a){this.meshes.splice(a,1)};OV.Model.prototype.GetMesh=function(a){return this.meshes[a]};OV.Model.prototype.Clear=function(){this.name="";this.materials=[];this.meshes=[]};OV.CalculateTriangleNormal=function(a,b,c){b=OV.SubCoord3D(b,a);a=OV.SubCoord3D(c,a);a=new OV.Coord3D(b.y*a.z-b.z*a.y,b.z*a.x-b.x*a.z,b.x*a.y-b.y*a.x);a.Normalize();return a};
OV.TransformMesh=function(a,b){if(!b.IsIdentity()){for(var c=0;c<a.VertexCount();c++){var d=a.GetVertex(c),e=b.TransformCoord3D(d);d.x=e.x;d.y=e.y;d.z=e.z}if(0<a.NormalCount())for(b=b.GetMatrix().DecomposeTRS(),b=(new OV.Matrix).ComposeTRS([0,0,0],b.rotation,[1,1,1]),b=new OV.Transformation(b),c=0;c<a.NormalCount();c++)d=a.GetNormal(c),e=b.TransformCoord3D(d),d.x=e.x,d.y=e.y,d.z=e.z}};
OV.FlipMeshTrianglesOrientation=function(a){for(var b=0;b<a.TriangleCount();b++){var c=a.GetTriangle(b),d=c.v1;c.v1=c.v2;c.v2=d}};OV.GetMeshBoundingBox=function(a){for(var b=new OV.Coord3D(Infinity,Infinity,Infinity),c=new OV.Coord3D(-Infinity,-Infinity,-Infinity),d=0;d<a.VertexCount();d++){var e=a.GetVertex(d);b.x=Math.min(b.x,e.x);b.y=Math.min(b.y,e.y);b.z=Math.min(b.z,e.z);c.x=Math.max(c.x,e.x);c.y=Math.max(c.y,e.y);c.z=Math.max(c.z,e.z)}return[b,c]};
OV.IsModelEmpty=function(a){for(var b=0;b<a.MeshCount();b++)if(0<a.GetMesh(b).TriangleCount())return!1;return!0};OV.CloneMesh=function(a){var b=new OV.Mesh;b.SetName(a.GetName());for(var c=0;c<a.VertexCount();c++){var d=a.GetVertex(c);b.AddVertex(d.Clone())}for(c=0;c<a.NormalCount();c++)d=a.GetNormal(c),b.AddNormal(d.Clone());for(c=0;c<a.TextureUVCount();c++)d=a.GetTextureUV(c),b.AddTextureUV(d.Clone());for(c=0;c<a.TriangleCount();c++)d=a.GetTriangle(c),b.AddTriangle(d.Clone());return b};
OV.CreateMergedModel=function(a){var b=new OV.Model;b.SetName(a.GetName());for(var c=0;c<a.MaterialCount();c++){var d=a.GetMaterial(c);b.AddMaterial(d.Clone())}c=new OV.Mesh;for(d=0;d<a.MeshCount();d++){for(var e=a.GetMesh(d),f=c,g=f.VertexCount(),h=f.NormalCount(),k=f.TextureUVCount(),l=0;l<e.VertexCount();l++){var m=e.GetVertex(l);f.AddVertex(m.Clone())}for(l=0;l<e.NormalCount();l++)m=e.GetNormal(l),f.AddNormal(m.Clone());for(l=0;l<e.TextureUVCount();l++)m=e.GetTextureUV(l),f.AddTextureUV(m.Clone());
for(l=0;l<e.TriangleCount();l++){m=e.GetTriangle(l);var n=m.Clone();n.SetVertices(m.v0+g,m.v1+g,m.v2+g);n.SetNormals(m.n0+h,m.n1+h,m.n2+h);n.HasTextureUVs()&&n.SetTextureUVs(m.u0+k,m.u1+k,m.u2+k);f.AddTriangle(n)}}b.AddMesh(c);return b};OV.FinalizeModel=function(a,b){function c(h,k){function l(p){function r(z,A,C,E,D){var G=new OV.Coord3D(0,0,0),F=0;C=D[C];for(D=0;D<C.length;D++){var H=C[D],I=z.GetTriangle(H);A.curve===I.curve&&(G=OV.AddCoord3D(G,E[H]),F+=1)}G.MultiplyScalar(1/F);G.Normalize();return z.AddNormal(G)}for(var t=[],w={},v=0;v<p.VertexCount();v++)w[v]=[];for(v=0;v<p.TriangleCount();v++){var u=p.GetTriangle(v),y=p.GetVertex(u.v0),x=p.GetVertex(u.v1),B=p.GetVertex(u.v2);y=OV.CalculateTriangleNormal(y,x,B);t.push(y);w[u.v0].push(v);
w[u.v1].push(v);w[u.v2].push(v)}for(v=0;v<p.TriangleCount();v++)if(u=p.GetTriangle(v),null===u.n0||null===u.n1||null===u.n2)y=r(p,u,u.v0,t,w),x=r(p,u,u.v1,t,w),B=r(p,u,u.v2,t,w),u.SetNormals(y,x,B)}function m(p,r,t){if(!r.HasNormals())if(null===r.curve||0===r.curve){var w=p.GetVertex(r.v0),v=p.GetVertex(r.v1),u=p.GetVertex(r.v2);w=OV.CalculateTriangleNormal(w,v,u);p=p.AddNormal(w);r.SetNormals(p,p,p)}else t.calculateCurveNormals=!0;null===r.mat&&(r.mat=t.getDefaultMaterialIndex());null===r.curve&&
(r.curve=0)}k={getDefaultMaterialIndex:k,calculateCurveNormals:!1};for(var n=0;n<h.TriangleCount();n++){var q=h.GetTriangle(n);m(h,q,k)}k.calculateCurveNormals&&l(h)}for(var d=null,e=function(){null===d&&(d=a.AddMaterial(b()));return d},f=0;f<a.MeshCount();f++){var g=a.GetMesh(f);0===g.TriangleCount()?(a.RemoveMesh(f),--f):c(g,e)}};
OV.CheckModel=function(a){function b(g){return void 0===g||null===g||isNaN(g)?!1:!0}function c(g,h){return!b(g)||0>g||g>=h?!1:!0}function d(g,h){for(var k=0;k<h.VertexCount();k++){var l=h.GetVertex(k);if(!b(l.x)||!b(l.y)||!b(l.z))return!1}for(k=0;k<h.NormalCount();k++)if(l=h.GetNormal(k),!b(l.x)||!b(l.y)||!b(l.z))return!1;for(k=0;k<h.TextureUVCount();k++)if(l=h.GetTextureUV(k),!b(l.x)||!b(l.y))return!1;for(k=0;k<h.TriangleCount();k++){var m=h.GetTriangle(k);l=g;var n=h;if(!(c(m.v0,n.VertexCount())&&
c(m.v1,n.VertexCount())&&c(m.v2,n.VertexCount())&&c(m.n0,n.NormalCount())&&c(m.n1,n.NormalCount())&&c(m.n2,n.NormalCount())&&(!m.HasTextureUVs()||c(m.u0,n.TextureUVCount())&&c(m.u1,n.TextureUVCount())&&c(m.u2,n.TextureUVCount()))&&c(m.mat,l.MaterialCount())&&b(m.curve)))return!1}return!0}for(var e=0;e<a.MeshCount();e++){var f=a.GetMesh(e);if(!d(a,f))return!1}return!0};OV.NameFromLine=function(a,b,c){a=a.substr(b);c=a.indexOf(c);-1!==c&&(a=a.substr(0,c));return a.trim()};OV.ParametersFromLine=function(a,b){null!==b&&(b=a.indexOf(b),-1!==b&&(a=a.substr(0,b).trim()));return a.split(/\s+/u)};OV.ReadLines=function(a,b){for(var c=0,d=a.indexOf("\n",c);-1!==d;){var e=a.substr(c,d-c);c=b;e=e.trim();0<e.length&&c(e);c=d+1;d=a.indexOf("\n",c)}a=a.substr(c).trim();0<a.length&&b(a)};OV.IsPowerOfTwo=function(a){return 0===(a&a-1)};
OV.NextPowerOfTwo=function(a){return OV.IsPowerOfTwo(a)?a:parseInt(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2))),10)};OV.ResizeImageToPowerOfTwoSides=function(a){if(OV.IsPowerOfTwo(a.width)&&OV.IsPowerOfTwo(a.height))return a;var b=OV.NextPowerOfTwo(a.width),c=OV.NextPowerOfTwo(a.height),d=document.createElement("canvas");d.width=b;d.height=c;d=d.getContext("2d");d.drawImage(a,0,0,b,c);return d.getImageData(0,0,b,c)};OV.ImporterBase=function(){};OV.ImporterBase.prototype.Import=function(a,b,c){this.Clear();this.extension=b;this.callbacks=c;this.model=new OV.Model;this.error=!1;this.message=null;this.ResetContent();var d=this;this.ImportContent(a,function(){d.CreateResult(c)})};OV.ImporterBase.prototype.Clear=function(){this.message=this.error=this.model=this.callbacks=this.extension=null;this.ClearContent()};
OV.ImporterBase.prototype.CreateResult=function(a){if(this.error)a.onError();else OV.IsModelEmpty(this.model)?(this.error=!0,a.onError()):(OV.FinalizeModel(this.model,this.callbacks.getDefaultMaterial),a.onSuccess());a.onComplete()};OV.ImporterBase.prototype.CanImportExtension=function(a){return!1};OV.ImporterBase.prototype.GetKnownFileFormats=function(){return{}};OV.ImporterBase.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterBase.prototype.ClearContent=function(){};
OV.ImporterBase.prototype.ResetContent=function(){};OV.ImporterBase.prototype.ImportContent=function(a,b){};OV.ImporterBase.prototype.GetModel=function(){return this.model};OV.ImporterBase.prototype.SetError=function(){this.error=!0};OV.ImporterBase.prototype.IsError=function(){return this.error};OV.ImporterBase.prototype.SetMessage=function(a){this.message=a};OV.ImporterBase.prototype.GetMessage=function(){return this.message};OV.ImporterObj=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterObj,OV.ImporterBase);OV.ImporterObj.prototype.CanImportExtension=function(a){return"obj"===a};OV.ImporterObj.prototype.GetKnownFileFormats=function(){return{obj:OV.FileFormat.Text,mtl:OV.FileFormat.Text}};OV.ImporterObj.prototype.GetUpDirection=function(){return OV.Direction.Y};
OV.ImporterObj.prototype.ClearContent=function(){this.materialNameToIndex=this.meshNameToMeshData=this.currentMaterialIndex=this.currentMaterial=this.currentMeshData=this.currentMesh=this.globalUvs=this.globalNormals=this.globalVertices=null};OV.ImporterObj.prototype.ResetContent=function(){this.globalVertices=[];this.globalNormals=[];this.globalUvs=[];this.currentMaterialIndex=this.currentMaterial=this.currentMeshData=this.currentMesh=null;this.meshNameToMeshData={};this.materialNameToIndex={}};
OV.ImporterObj.prototype.ImportContent=function(a,b){var c=this;OV.ReadLines(a,function(d){c.IsError()||c.ProcessLine(d)});b()};OV.ImporterObj.prototype.ProcessLine=function(a){if("#"!==a[0]){var b=OV.ParametersFromLine(a,"#");if(0!==b.length){var c=b[0].toLowerCase();b.shift();this.ProcessMeshParameter(c,b,a)||this.ProcessMaterialParameter(c,b,a)}}};
OV.ImporterObj.prototype.AddNewMesh=function(a){var b=this.meshNameToMeshData[a];void 0===b&&(b=new OV.Mesh,null!==a&&b.SetName(a),this.model.AddMesh(b),b={mesh:b,data:{globalToCurrentVertices:{},globalToCurrentNormals:{},globalToCurrentUvs:{}}},this.meshNameToMeshData[a]=b);this.currentMesh=b.mesh;this.currentMeshData=b.data};
OV.ImporterObj.prototype.ProcessMeshParameter=function(a,b,c){if("g"===a||"o"===a){if(0===b.length)return!0;a=OV.NameFromLine(c,a.length,"#");this.AddNewMesh(a);return!0}if("v"===a){if(3>b.length)return!0;this.globalVertices.push(new OV.Coord3D(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2])));return!0}if("vn"===a){if(3>b.length)return!0;this.globalNormals.push(new OV.Coord3D(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2])));return!0}if("vt"===a){if(2>b.length)return!0;this.globalUvs.push(new OV.Coord2D(parseFloat(b[0]),
parseFloat(b[1])));return!0}if("f"===a){if(3>b.length)return!0;this.ProcessFace(b);return!0}return!1};
OV.ImporterObj.prototype.ProcessMaterialParameter=function(a,b,c){function d(g){return new OV.Color(parseInt(parseFloat(255*g[0]),10),parseInt(parseFloat(255*g[1]),10),parseInt(parseFloat(255*g[2]),10))}function e(g,h,k){var l=new OV.TextureMap;g=OV.NameFromLine(h,g.length,"#");k=k.getTextureBuffer(g);l.name=g;null!==k&&(l.url=k.url,l.buffer=k.buffer);return l}var f=this;if("newmtl"===a){if(0===b.length)return!0;b=new OV.Material;a=OV.NameFromLine(c,a.length,"#");c=this.model.AddMaterial(b);b.name=
a;this.currentMaterial=b;this.materialNameToIndex[a]=c;return!0}if("usemtl"===a){if(0===b.length)return!0;b=OV.NameFromLine(c,a.length,"#");b=this.materialNameToIndex[b];void 0!==b&&(this.currentMaterialIndex=b);return!0}if("mtllib"===a){if(0===b.length)return!0;b=OV.NameFromLine(c,a.length,"#");b=this.callbacks.getFileBuffer(b);null!==b&&OV.ReadLines(b,function(g){f.IsError()||f.ProcessLine(g)});return!0}if("map_kd"===a){if(null===this.currentMaterial||0===b.length)return!0;this.currentMaterial.diffuseMap=
e(a,c,this.callbacks);return!0}if("map_ks"===a){if(null===this.currentMaterial||0===b.length)return!0;this.currentMaterial.specularMap=e(a,c,this.callbacks);return!0}if("map_bump"===a||"bump"===a){if(null===this.currentMaterial||0===b.length)return!0;this.currentMaterial.bumpMap=e(a,c,this.callbacks);return!0}if("ka"===a){if(null===this.currentMaterial||3>b.length)return!0;this.currentMaterial.ambient=d(b);return!0}if("kd"===a){if(null===this.currentMaterial||3>b.length)return!0;this.currentMaterial.diffuse=
d(b);return!0}if("ks"===a){if(null===this.currentMaterial||3>b.length)return!0;this.currentMaterial.specular=d(b);return!0}if("ns"===a){if(null===this.currentMaterial||1>b.length)return!0;this.currentMaterial.shininess=parseFloat(b[0])/1E3;return!0}if("tr"===a){if(null===this.currentMaterial||1>b.length)return!0;this.currentMaterial.opacity=1-parseFloat(b[0]);this.currentMaterial.transparent=OV.IsLower(this.currentMaterial.opacity,1);return!0}if("d"===a){if(null===this.currentMaterial||1>b.length)return!0;
this.currentMaterial.opacity=parseFloat(b[0]);this.currentMaterial.transparent=OV.IsLower(this.currentMaterial.opacity,1);return!0}return!1};
OV.ImporterObj.prototype.ProcessFace=function(a){function b(p,r){return 0<p?p-1:r+p}function c(p,r,t,w){if(isNaN(t)||0>t||t>=p.length)return null;var v=r[t];if(void 0===v){p=p[t];if(void 0===p)return null;v=w(p);r[t]=v}return v}function d(p,r,t){return c(p.globalVertices,p.currentMeshData.globalToCurrentVertices,t,function(w){return r.AddVertex(new OV.Coord3D(w.x,w.y,w.z))})}function e(p,r,t){return c(p.globalNormals,p.currentMeshData.globalToCurrentNormals,t,function(w){return r.AddNormal(new OV.Coord3D(w.x,
w.y,w.z))})}function f(p,r,t){return c(p.globalUvs,p.currentMeshData.globalToCurrentUvs,t,function(w){return r.AddTextureUV(new OV.Coord2D(w.x,w.y))})}for(var g=[],h=[],k=[],l=0;l<a.length;l++){var m=a[l].split("/");g.push(b(parseInt(m[0],10),this.globalVertices.length));1<m.length&&0<m[1].length&&k.push(b(parseInt(m[1],10),this.globalUvs.length));2<m.length&&0<m[2].length&&h.push(b(parseInt(m[2],10),this.globalNormals.length))}null===this.currentMesh&&this.AddNewMesh("");for(a=0;a<g.length-2;a++){l=
d(this,this.currentMesh,g[0]);m=d(this,this.currentMesh,g[a+1]);var n=d(this,this.currentMesh,g[a+2]);if(null===l||null===m||null===n){this.SetError();this.SetMessage("Invalid vertex index.");break}l=new OV.Triangle(l,m,n);if(h.length===g.length){m=e(this,this.currentMesh,h[0]);n=e(this,this.currentMesh,h[a+1]);var q=e(this,this.currentMesh,h[a+2]);if(null===m||null===n||null===q){this.SetError();this.SetMessage("Invalid normal index.");break}l.SetNormals(m,n,q)}if(k.length===g.length){m=f(this,this.currentMesh,
k[0]);n=f(this,this.currentMesh,k[a+1]);q=f(this,this.currentMesh,k[a+2]);if(null===m||null===n||null===q){this.SetError();this.SetMessage("Invalid uv index.");break}l.SetTextureUVs(m,n,q)}null!==this.currentMaterialIndex&&(l.mat=this.currentMaterialIndex);this.currentMesh.AddTriangle(l)}};OV.ImporterStl=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterStl,OV.ImporterBase);OV.ImporterStl.prototype.CanImportExtension=function(a){return"stl"===a};OV.ImporterStl.prototype.GetKnownFileFormats=function(){return{stl:OV.FileFormat.Binary}};OV.ImporterStl.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterStl.prototype.ClearContent=function(){this.triangle=this.mesh=null};
OV.ImporterStl.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMesh(this.mesh);this.triangle=null};OV.ImporterStl.prototype.ImportContent=function(a,b){if(this.IsBinaryStlFile(a))this.ProcessBinary(a);else{var c=this;a=OV.ArrayBufferToUtf8String(a);OV.ReadLines(a,function(d){c.IsError()||c.ProcessLine(d)})}b()};
OV.ImporterStl.prototype.IsBinaryStlFile=function(a){var b=a.byteLength;if(84>b)return!1;a=new OV.BinaryReader(a,!0);a.Skip(80);a=a.ReadUnsignedInteger32();return b!==50*a+84?!1:!0};
OV.ImporterStl.prototype.ProcessLine=function(a){if("#"!==a[0]){var b=OV.ParametersFromLine(a,"#");if(0!==b.length){var c=b[0];"solid"===c?1<b.length&&(a=OV.NameFromLine(a,c.length,"#"),this.mesh.SetName(a)):"facet"===c?(this.triangle=new OV.Triangle(-1,-1,-1),5<=b.length&&"normal"===b[1]&&(a=new OV.Coord3D(parseFloat(b[2]),parseFloat(b[3]),parseFloat(b[4])),OV.IsPositive(a.Length())&&(a=this.mesh.AddNormal(a),this.triangle.SetNormals(a,a,a)))):"vertex"===c&&null!==this.triangle?4<=b.length&&(a=this.mesh.AddVertex(new OV.Coord3D(parseFloat(b[1]),
parseFloat(b[2]),parseFloat(b[3]))),-1===this.triangle.v0?this.triangle.v0=a:-1===this.triangle.v1?this.triangle.v1=a:-1===this.triangle.v2&&(this.triangle.v2=a)):"endfacet"===c&&null!==this.triangle&&(-1!==this.triangle.v0&&-1!==this.triangle.v1&&null!==this.triangle.v2&&this.mesh.AddTriangle(this.triangle),this.triangle=null)}}};
OV.ImporterStl.prototype.ProcessBinary=function(a){function b(l){var m=new OV.Coord3D;m.x=l.ReadFloat32();m.y=l.ReadFloat32();m.z=l.ReadFloat32();return m}function c(l,m){m=b(m);return l.AddVertex(m)}a=new OV.BinaryReader(a,!0);a.Skip(80);for(var d=a.ReadUnsignedInteger32(),e=0;e<d;e++){var f=b(a),g=c(this.mesh,a),h=c(this.mesh,a),k=c(this.mesh,a);a.Skip(2);g=new OV.Triangle(g,h,k);OV.IsPositive(f.Length())&&(f=this.mesh.AddNormal(f),g.SetNormals(f,f,f));this.mesh.AddTriangle(g)}};OV.ImporterOff=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterOff,OV.ImporterBase);OV.ImporterOff.prototype.CanImportExtension=function(a){return"off"===a};OV.ImporterOff.prototype.GetKnownFileFormats=function(){return{off:OV.FileFormat.Text}};OV.ImporterOff.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterOff.prototype.ClearContent=function(){this.status=this.mesh=this.model=null};
OV.ImporterOff.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMesh(this.mesh);this.status={vertexCount:0,faceCount:0,foundVertex:0,foundFace:0}};OV.ImporterOff.prototype.ImportContent=function(a,b){var c=this;OV.ReadLines(a,function(d){c.IsError()||c.ProcessLine(d)});b()};
OV.ImporterOff.prototype.ProcessLine=function(a){if("#"!==a[0]&&(a=OV.ParametersFromLine(a,"#"),0!==a.length&&"OFF"!==a[0]))if(0===this.status.vertexCount&&0===this.status.faceCount)1<a.length&&(this.status.vertexCount=parseInt(a[0],10),this.status.faceCount=parseInt(a[1],10));else if(this.status.foundVertex<this.status.vertexCount)3<=a.length&&(this.mesh.AddVertex(new OV.Coord3D(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))),this.status.foundVertex+=1);else if(this.status.foundFace<this.status.faceCount&&
4<=a.length){var b=parseInt(a[0],10);if(!(a.length<b+1)){for(var c=0;c<b-2;c++){var d=parseInt(a[1]),e=parseInt(a[c+2]),f=parseInt(a[c+3]);d=new OV.Triangle(d,e,f);this.mesh.AddTriangle(d)}this.status.foundFace+=1}}};OV.PlyHeader=function(){this.format=null;this.elements=[]};OV.PlyHeader.prototype.SetFormat=function(a){this.format=a};OV.PlyHeader.prototype.AddElement=function(a,b){this.elements.push({name:a,count:b,format:[]})};OV.PlyHeader.prototype.GetElements=function(){return this.elements};OV.PlyHeader.prototype.AddSingleFormat=function(a,b){this.elements[this.elements.length-1].format.push({name:b,isSingle:!0,elemType:a})};
OV.PlyHeader.prototype.AddListFormat=function(a,b,c){this.elements[this.elements.length-1].format.push({name:c,isSingle:!1,countType:a,elemType:b})};OV.PlyHeader.prototype.GetElement=function(a){for(var b=0;b<this.elements.length;b++){var c=this.elements[b];if(c.name===a)return c}return null};
OV.PlyHeader.prototype.Check=function(){var a=this.GetElement("vertex");if(null===a||0===a.length||3>a.format.length)return!1;a=this.GetElement("face");if("ascii"===this.format){if(null===a||0===a.count||0>a.format.length)return!1}else if("binary_little_endian"===this.format||"binary_big_endian"===this.format){var b=this.GetElement("tristrips");b=null!==b&&0<b.count&&0<b.format.length;if(!(null!==a&&0<a.count&&0<a.format.length||b))return!1}else return!1;return!0};OV.ImporterPly=function(){OV.ImporterBase.call(this)};
$jscomp.inherits(OV.ImporterPly,OV.ImporterBase);OV.ImporterPly.prototype.CanImportExtension=function(a){return"ply"===a};OV.ImporterPly.prototype.GetKnownFileFormats=function(){return{ply:OV.FileFormat.Binary}};OV.ImporterPly.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterPly.prototype.ClearContent=function(){this.mesh=this.model=null};OV.ImporterPly.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMesh(this.mesh)};
OV.ImporterPly.prototype.ImportContent=function(a,b){var c=this.GetHeaderContent(a),d=this.ReadHeader(c);d.Check()?"ascii"===d.format?(a=OV.ArrayBufferToUtf8String(a),a=a.substr(c.length),this.ReadAsciiContent(d,a)):"binary_little_endian"!==d.format&&"binary_big_endian"!==d.format||this.ReadBinaryContent(d,a,c.length):(this.SetError(),this.SetMessage("Invalid header information."));b()};
OV.ImporterPly.prototype.GetHeaderContent=function(a){var b="",c=new Uint8Array(a),d;for(d=0;d<a.byteLength&&(b+=String.fromCharCode(c[d]),!b.endsWith("end_header"));d++);for(d+=1;d<a.byteLength;){var e=String.fromCharCode(c[d]);b+=e;d+=1;if("\n"===e)break}return b};
OV.ImporterPly.prototype.ReadHeader=function(a){var b=new OV.PlyHeader;OV.ReadLines(a,function(c){c=OV.ParametersFromLine(c,null);0!==c.length&&"comment"!==c[0]&&"ply"!==c[0]&&("format"===c[0]&&2<=c.length?b.SetFormat(c[1]):"element"===c[0]&&3<=c.length?b.AddElement(c[1],parseInt(c[2],10)):"property"===c[0]&&3<=c.length&&("list"===c[1]&&5<=c.length?b.AddListFormat(c[2],c[3],c[4]):b.AddSingleFormat(c[1],c[2])))});return b};
OV.ImporterPly.prototype.ReadAsciiContent=function(a,b){var c=this,d=a.GetElement("vertex"),e=a.GetElement("face"),f=0,g=0;OV.ReadLines(b,function(h){if(!c.IsError()&&(h=OV.ParametersFromLine(h,null),0!==h.length&&"comment"!==h[0]))if(f<d.count)3<=h.length&&(c.mesh.AddVertex(new OV.Coord3D(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]))),f+=1);else if(g<e.count&&4<=h.length){var k=parseInt(h[0],10);if(!(h.length<k+1)){for(var l=0;l<k-2;l++){var m=parseInt(h[1]),n=parseInt(h[l+2]),q=parseInt(h[l+
3]);m=new OV.Triangle(m,n,q);c.mesh.AddTriangle(m)}g+=1}}})};
OV.ImporterPly.prototype.ReadBinaryContent=function(a,b,c){function d(v,u,y,x){for(var B=null,z=null,A=null,C=255;x<y.length;x++){var E=y[x],D=v.ReadByFormat(u,E);"red"===E.name?B=D:"green"===E.name?z=D:"blue"===E.name?A=D:"alpha"===E.name&&(C=D)}return null!==B&&null!==z&&null!==A?[B,z,A,C]:null}function e(v,u,y){function x(A){for(A=parseInt(A,10).toString(16);2>A.length;)A="0"+A;return A}if(null===u)return null;var B="Color "+x(u[0])+x(u[1])+x(u[2])+x(u[3]),z=y[B];void 0===z&&(z=new OV.Material,
z.name=B,z.diffuse=new OV.Color(u[0],u[1],u[2]),z.opacity=u[3]/255,z.transparent=OV.IsLower(z.opacity,1),z=v.model.AddMaterial(z),y[B]=z);return z}function f(v,u,y,x,B,z){u=B[u];y=B[y];x=B[x];B=Math.abs(y[0]-x[0])+Math.abs(y[1]-x[1])+Math.abs(y[2]-x[2]);var A=u;Math.min(Math.abs(u[0]-y[0])+Math.abs(u[1]-y[1])+Math.abs(u[2]-y[2]),B,Math.abs(u[0]-x[0])+Math.abs(u[1]-x[1])+Math.abs(u[2]-x[2]))===B&&(A=y);return e(v,A,z)}var g=null;if("binary_little_endian"===a.format)g=new OV.BinaryReader(b,!0);else if("binary_big_endian"===
a.format)g=new OV.BinaryReader(b,!1);else return;g.Skip(c);b=[];c={};a=a.GetElements();for(var h=0;h<a.length;h++){var k=a[h];if("vertex"===k.name)for(var l=0;l<k.count;l++){var m=this.ReadByFormat(g,k.format[0]),n=this.ReadByFormat(g,k.format[1]),q=this.ReadByFormat(g,k.format[2]),p=d(this,g,k.format,3);null!==p&&b.push(p);this.mesh.AddVertex(new OV.Coord3D(m,n,q))}else if("face"===k.name)for(l=0;l<k.count;l++)for(m=this.ReadByFormat(g,k.format[0]),n=d(this,g,k.format,1),q=0;q<m.length-2;q++){p=
m[0];var r=m[q+1],t=m[q+2],w=new OV.Triangle(p,r,t);null!==n?w.mat=e(this,n,c):b.length===this.model.VertexCount()&&(w.mat=f(this,p,r,t,b,c));this.mesh.AddTriangle(w)}else if("tristrips"===k.name)for(l=0;l<k.count;l++)for(m=this.ReadByFormat(g,k.format[0]),this.SkipFormat(g,k.format,1),n=!0,q=0;q<m.length-2;q++)p=m[q],r=m[q+1],t=m[q+2],-1===t?(q+=2,n=!0):(n||(w=r,r=t,t=w),n=!n,p=new OV.Triangle(p,r,t),this.mesh.AddTriangle(p));else this.SkipFormat(g,k.format,0)}};
OV.ImporterPly.prototype.SkipFormat=function(a,b,c){for(;c<b.length;c++)this.ReadByFormat(a,b[c])};
OV.ImporterPly.prototype.ReadByFormat=function(a,b){function c(g,h){return"char"===h||"int8"===h?g.ReadCharacter8():"uchar"===h||"uint8"===h?g.ReadUnsignedCharacter8():"short"===h||"int16"===h?g.ReadInteger16():"ushort"===h||"uint16"===h?g.ReadUnsignedInteger16():"int"===h||"int32"===h?g.ReadInteger32():"uint"===h||"uint32"===h?g.ReadUnsignedInteger32():"float"===h||"float32"===h?g.ReadFloat32():"double"===h||"double64"===h?g.ReadDouble64():null}if(b.isSingle)return c(a,b.elemType);for(var d=[],e=
c(a,b.countType),f=0;f<e;f++)d.push(c(a,b.elemType));return d};OV.CHUNK3DS={MAIN3DS:19789,EDIT3DS:15677,EDIT_MATERIAL:45055,MAT_NAME:40960,MAT_AMBIENT:40976,MAT_DIFFUSE:40992,MAT_SPECULAR:41008,MAT_SHININESS:41024,MAT_SHININESS_STRENGTH:41025,MAT_TRANSPARENCY:41040,MAT_COLOR_F:16,MAT_COLOR:17,MAT_LIN_COLOR:18,MAT_LIN_COLOR_F:19,MAT_TEXMAP:41472,MAT_TEXMAP_NAME:41728,MAT_TEXMAP_UOFFSET:41816,MAT_TEXMAP_VOFFSET:41818,MAT_TEXMAP_USCALE:41812,MAT_TEXMAP_VSCALE:41814,MAT_TEXMAP_ROTATION:41820,PERCENTAGE:48,PERCENTAGE_F:49,EDIT_OBJECT:16384,OBJ_TRIMESH:16640,OBJ_LIGHT:17920,
OBJ_CAMERA:18176,TRI_VERTEX:16656,TRI_TEXVERTEX:16704,TRI_FACE:16672,TRI_TRANSFORMATION:16736,TRI_MATERIAL:16688,TRI_SMOOTH:16720,KF3DS:45056,OBJECT_NODE:45058,OBJECT_HIERARCHY:45072,OBJECT_INSTANCE_NAME:45073,OBJECT_PIVOT:45075,OBJECT_POSITION:45088,OBJECT_ROTATION:45089,OBJECT_SCALE:45090,OBJECT_ID:45104};OV.Importer3ds=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.Importer3ds,OV.ImporterBase);OV.Importer3ds.prototype.CanImportExtension=function(a){return"3ds"===a};
OV.Importer3ds.prototype.GetKnownFileFormats=function(){return{"3ds":OV.FileFormat.Binary}};OV.Importer3ds.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.Importer3ds.prototype.ClearContent=function(){this.defaultMaterialIndex=this.meshTransformations=this.meshNameToIndex=this.materialNameToIndex=null};OV.Importer3ds.prototype.ResetContent=function(){this.materialNameToIndex={};this.meshNameToIndex={};this.meshTransformations=[];this.defaultMaterialIndex=null};
OV.Importer3ds.prototype.ImportContent=function(a,b){this.ProcessBinary(a);b()};OV.Importer3ds.prototype.ProcessBinary=function(a){var b=this,c=new OV.BinaryReader(a,!0);a=c.GetByteLength();this.ReadChunks(c,a,function(d,e){d===OV.CHUNK3DS.MAIN3DS?b.ReadMainChunk(c,e):b.SkipChunk(c,e)})};
OV.Importer3ds.prototype.ReadMainChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(d,e){d===OV.CHUNK3DS.EDIT3DS?c.ReadEditorChunk(a,e):d===OV.CHUNK3DS.KF3DS?c.ReadKeyFrameChunk(a,e):c.SkipChunk(a,e)})};OV.Importer3ds.prototype.ReadEditorChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(d,e){d===OV.CHUNK3DS.EDIT_MATERIAL?c.ReadMaterialChunk(a,e):d===OV.CHUNK3DS.EDIT_OBJECT?c.ReadObjectChunk(a,e):c.SkipChunk(a,e)})};
OV.Importer3ds.prototype.ReadMaterialChunk=function(a,b){var c=this,d=new OV.Material;b=this.GetChunkEnd(a,b);var e=null,f=null;this.ReadChunks(a,b,function(g,h){g===OV.CHUNK3DS.MAT_NAME?d.name=c.ReadName(a):g===OV.CHUNK3DS.MAT_AMBIENT?d.ambient=c.ReadColorChunk(a,h):g===OV.CHUNK3DS.MAT_DIFFUSE?d.diffuse=c.ReadColorChunk(a,h):g===OV.CHUNK3DS.MAT_SPECULAR?d.specular=c.ReadColorChunk(a,h):g===OV.CHUNK3DS.MAT_SHININESS?e=c.ReadPercentageChunk(a,h):g===OV.CHUNK3DS.MAT_SHININESS_STRENGTH?f=c.ReadPercentageChunk(a,
h):g===OV.CHUNK3DS.MAT_TRANSPARENCY?(d.opacity=1-c.ReadPercentageChunk(a,h),d.transparent=OV.IsLower(d.opacity,1)):g===OV.CHUNK3DS.MAT_TEXMAP?d.diffuseMap=c.ReadTextureMapChunk(a,h):c.SkipChunk(a,h)});null!==e&&null!==f&&(d.shininess=e*f/10);b=this.model.AddMaterial(d);this.materialNameToIndex[d.name]=b};
OV.Importer3ds.prototype.ReadTextureMapChunk=function(a,b){var c=this,d=new OV.TextureMap;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(e,f){e===OV.CHUNK3DS.MAT_TEXMAP_NAME?(e=c.ReadName(a),f=c.callbacks.getTextureBuffer(e),d.name=e,null!==f&&(d.url=f.url,d.buffer=f.buffer)):e===OV.CHUNK3DS.MAT_TEXMAP_UOFFSET?d.offset.x=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_VOFFSET?d.offset.y=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_USCALE?d.scale.x=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_VSCALE?
d.scale.y=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_ROTATION?d.rotation=a.ReadFloat32()*OV.DegRad:c.SkipChunk(a,f)});return d};
OV.Importer3ds.prototype.ReadColorChunk=function(a,b){var c=this,d=new OV.Color(0,0,0);b=this.GetChunkEnd(a,b);var e=!1;this.ReadChunks(a,b,function(f,g){f===OV.CHUNK3DS.MAT_COLOR?e||(d.r=a.ReadUnsignedCharacter8(),d.g=a.ReadUnsignedCharacter8(),d.b=a.ReadUnsignedCharacter8()):f===OV.CHUNK3DS.MAT_LIN_COLOR?(d.r=a.ReadUnsignedCharacter8(),d.g=a.ReadUnsignedCharacter8(),d.b=a.ReadUnsignedCharacter8(),e=!0):f===OV.CHUNK3DS.MAT_COLOR_F?e||(d.r=parseInt(255*a.ReadFloat32(),10),d.g=parseInt(255*a.ReadFloat32(),
10),d.b=parseInt(255*a.ReadFloat32(),10)):f===OV.CHUNK3DS.MAT_LIN_COLOR_F?(d.r=parseInt(255*a.ReadFloat32(),10),d.g=parseInt(255*a.ReadFloat32(),10),d.b=parseInt(255*a.ReadFloat32(),10),e=!0):c.SkipChunk(a,g)});return d};OV.Importer3ds.prototype.ReadPercentageChunk=function(a,b){var c=this,d=0;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(e,f){e===OV.CHUNK3DS.PERCENTAGE?d=a.ReadUnsignedInteger16()/100:e===OV.CHUNK3DS.PERCENTAGE_F?d=a.ReadFloat32():c.SkipChunk(a,f)});return d};
OV.Importer3ds.prototype.ReadObjectChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);var d=this.ReadName(a);this.ReadChunks(a,b,function(e,f){e===OV.CHUNK3DS.OBJ_TRIMESH?c.ReadMeshChunk(a,f,d):c.SkipChunk(a,f)})};
OV.Importer3ds.prototype.ReadMeshChunk=function(a,b,c){var d=this,e=new OV.Mesh;e.SetName(c);b=this.GetChunkEnd(a,b);var f=null;this.ReadChunks(a,b,function(g,h){g===OV.CHUNK3DS.TRI_VERTEX?d.ReadVerticesChunk(e,a):g===OV.CHUNK3DS.TRI_TEXVERTEX?d.ReadTextureVerticesChunk(e,a):g===OV.CHUNK3DS.TRI_FACE?d.ReadFacesChunk(e,a,h):g===OV.CHUNK3DS.TRI_TRANSFORMATION?f=d.ReadTransformationChunk(a):d.SkipChunk(a,h)});if(e.VertexCount()===e.TextureUVCount())for(b=0;b<e.TriangleCount();b++)c=e.GetTriangle(b),
c.SetTextureUVs(c.v0,c.v1,c.v2);b=this.model.AddMesh(e);this.meshNameToIndex[e.GetName()]=b;this.meshTransformations.push(new OV.Matrix(f))};OV.Importer3ds.prototype.ReadVerticesChunk=function(a,b){for(var c=b.ReadUnsignedInteger16(),d=0;d<c;d++){var e=b.ReadFloat32(),f=b.ReadFloat32(),g=b.ReadFloat32();a.AddVertex(new OV.Coord3D(e,f,g))}};
OV.Importer3ds.prototype.ReadTextureVerticesChunk=function(a,b){for(var c=b.ReadUnsignedInteger16(),d=0;d<c;d++){var e=b.ReadFloat32(),f=b.ReadFloat32();a.AddTextureUV(new OV.Coord2D(e,f))}};
OV.Importer3ds.prototype.ReadFacesChunk=function(a,b,c){c=this.GetChunkEnd(b,c);for(var d=b.ReadUnsignedInteger16(),e=0;e<d;e++){var f=b.ReadUnsignedInteger16(),g=b.ReadUnsignedInteger16(),h=b.ReadUnsignedInteger16();b.ReadUnsignedInteger16();a.AddTriangle(new OV.Triangle(f,g,h))}var k=this;this.ReadChunks(b,c,function(l,m){l===OV.CHUNK3DS.TRI_MATERIAL?k.ReadFaceMaterialsChunk(a,b):l===OV.CHUNK3DS.TRI_SMOOTH?k.ReadFaceSmoothingGroupsChunk(a,d,b):k.SkipChunk(b,m)})};
OV.Importer3ds.prototype.ReadFaceMaterialsChunk=function(a,b){var c=this.ReadName(b);c=this.materialNameToIndex[c];for(var d=b.ReadUnsignedInteger16(),e=0;e<d;e++){var f=b.ReadUnsignedInteger16();f=a.GetTriangle(f);void 0!==c&&(f.mat=c)}};OV.Importer3ds.prototype.ReadFaceSmoothingGroupsChunk=function(a,b,c){for(var d=0;d<b;d++){var e=c.ReadUnsignedInteger32();a.GetTriangle(d).curve=e}};
OV.Importer3ds.prototype.ReadTransformationChunk=function(a){for(var b=[],c=0;4>c;c++){for(var d=0;3>d;d++)b.push(a.ReadFloat32());3>c?b.push(0):b.push(1)}return b};OV.Importer3ds.prototype.ReadKeyFrameChunk=function(a,b){var c={nodes:[],idToIndex:{},meshIndexToNodes:{}};b=this.GetChunkEnd(a,b);var d=this;this.ReadChunks(a,b,function(e,f){e===OV.CHUNK3DS.OBJECT_NODE?d.ReadObjectNodeChunk(c,a,f):d.SkipChunk(a,f)});this.ApplyModelTransformations(c)};
OV.Importer3ds.prototype.ApplyModelTransformations=function(a){function b(q,p){if(null!==p.matrix)return p.matrix;var r=new OV.Matrix,t=r,w=t.ComposeTRS;var v=0===p.positions.length?[0,0,0]:p.positions[0];if(0===p.rotations.length)var u=[0,0,0,1];else{u=p.rotations[0];var y=[0,0,0,1],x=Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2]);0<x&&(y=-.5*u[3],x=Math.sin(y)/x,y=[x*u[0],x*u[1],x*u[2],Math.cos(y)]);u=y}x=0===p.scales.length?[1,1,1]:p.scales[0];w.call(t,v,u,x);65535!==p.userId&&(t=q.idToIndex[p.userId],
void 0!==t&&(q=b(q,q.nodes[t]),r=r.MultiplyMatrix(q)));return p.matrix=r}function c(q,p,r,t,w){if(r.IsValid()){var v=r;null!==w&&(v=b(t,w));q=q.GetMesh(p);p=r.Determinant();(p=OV.IsNegative(p))&&(r=(new OV.Matrix).CreateScale(-1,1,1).MultiplyMatrix(r));r=r.Invert();null!==r&&(w=null===w?[0,0,0]:w.pivot,w=(new OV.Matrix).CreateTranslation(-w[0],-w[1],-w[2]),v=v.Clone(),v=w.MultiplyMatrix(v),v=r.MultiplyMatrix(v),v=new OV.Transformation(v),p&&OV.FlipMeshTrianglesOrientation(q),OV.TransformMesh(q,v))}}
function d(q,p,r){p=q.GetMesh(p);p=OV.CloneMesh(p);return q.AddMeshToIndex(p,r)}for(var e=0,f=0;f<this.model.MeshCount();f++){var g=f,h=g-e,k=this.meshTransformations[h];h=a.meshIndexToNodes[h];if(void 0===h)c(this.model,g,k,a,null);else for(var l=0;l<h.length;l++){var m=h[l],n=g;0<l&&(n=d(this.model,g,g+l),e+=1,f+=1);c(this.model,n,k,a,m)}}};
OV.Importer3ds.prototype.ReadObjectNodeChunk=function(a,b,c){function d(g,h,k){var l=[];h.Skip(10);for(var m=h.ReadInteger32(),n=0;n<m;n++){h.ReadInteger32();0!==h.ReadUnsignedInteger16()&&h.ReadFloat32();if(k===OV.CHUNK3DS.OBJECT_ROTATION){var q=h.ReadFloat32();var p=g.ReadVector(h);p[3]=q}else p=g.ReadVector(h);l.push(p)}return l}var e={name:"",instanceName:"",nodeId:-1,flags:-1,userId:-1,pivot:[0,0,0],positions:[],rotations:[],scales:[],matrix:null},f=this;c=this.GetChunkEnd(b,c);this.ReadChunks(b,
c,function(g,h){g===OV.CHUNK3DS.OBJECT_HIERARCHY?(e.name=f.ReadName(b),e.flags=b.ReadUnsignedInteger32(),e.userId=b.ReadUnsignedInteger16()):g===OV.CHUNK3DS.OBJECT_INSTANCE_NAME?e.instanceName=f.ReadName(b):g===OV.CHUNK3DS.OBJECT_PIVOT?e.pivot=f.ReadVector(b):g===OV.CHUNK3DS.OBJECT_POSITION?e.positions=d(f,b,OV.CHUNK3DS.OBJECT_POSITION):g===OV.CHUNK3DS.OBJECT_ROTATION?e.rotations=d(f,b,OV.CHUNK3DS.OBJECT_ROTATION):g===OV.CHUNK3DS.OBJECT_SCALE?e.scales=d(f,b,OV.CHUNK3DS.OBJECT_SCALE):g===OV.CHUNK3DS.OBJECT_ID?
e.nodeId=b.ReadUnsignedInteger16():f.SkipChunk(b,h)});c=a.nodes.length;a.nodes.push(e);a.idToIndex[e.nodeId]=c;c=this.meshNameToIndex[e.name];void 0!==c&&(void 0===a.meshIndexToNodes[c]&&(a.meshIndexToNodes[c]=[]),a.meshIndexToNodes[c].push(e))};OV.Importer3ds.prototype.ReadName=function(a){for(var b="",c,d=0;64>d;){c=a.ReadCharacter8();if(0===c)break;b+=String.fromCharCode(c);d+=1}return b};OV.Importer3ds.prototype.ReadVector=function(a){return[a.ReadFloat32(),a.ReadFloat32(),a.ReadFloat32()]};
OV.Importer3ds.prototype.ReadChunks=function(a,b,c){for(;a.GetPosition()<=b-6;){var d=a.ReadUnsignedInteger16(),e=a.ReadUnsignedInteger32();c(d,e)}};OV.Importer3ds.prototype.GetChunkEnd=function(a,b){return a.GetPosition()+b-6};OV.Importer3ds.prototype.SkipChunk=function(a,b){a.Skip(b-6)};OV.GltfComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};OV.GltfDataType={SCALAR:0,VEC2:1,VEC3:2,VEC4:3,MAT2:4,MAT3:5,MAT4:6};OV.GltfRenderMode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};OV.GltfConstants={GLTF_STRING:1179937895,JSON_CHUNK_TYPE:1313821514,BINARY_CHUNK_TYPE:5130562};OV.GltfNodeTree=function(){this.nodes=[];this.nodeToParent={};this.nodeMatrices={}};
OV.GltfNodeTree.prototype.AddMeshNode=function(a){this.nodes.push(a);return this.nodes.length-1};OV.GltfNodeTree.prototype.AddNodeParent=function(a,b){this.nodeToParent[a]=b};OV.GltfNodeTree.prototype.GetNodeParent=function(a){a=this.nodeToParent[a];return void 0===a||-1===a?null:a};OV.GltfNodeTree.prototype.AddNodeMatrix=function(a,b){this.nodeMatrices[a]=b};OV.GltfNodeTree.prototype.GetNodeMatrix=function(a){a=this.nodeMatrices[a];return void 0===a?null:a};
OV.GltfBufferReader=function(a){this.reader=new OV.BinaryReader(a,!0);this.sparseReader=this.dataCount=this.byteStride=this.dataType=this.componentType=null};OV.GltfBufferReader.prototype.SetComponentType=function(a){this.componentType=a};
OV.GltfBufferReader.prototype.SetDataType=function(a){"SCALAR"===a?this.dataType=OV.GltfDataType.SCALAR:"VEC2"===a?this.dataType=OV.GltfDataType.VEC2:"VEC3"===a?this.dataType=OV.GltfDataType.VEC3:"VEC4"===a?this.dataType=OV.GltfDataType.VEC4:"MAT2"===a?this.dataType=OV.GltfDataType.MAT2:"MAT3"===a?this.dataType=OV.GltfDataType.MAT3:"MAT4"===a&&(this.dataType=OV.GltfDataType.MAT4)};OV.GltfBufferReader.prototype.SetByteStride=function(a){this.byteStride=a};
OV.GltfBufferReader.prototype.SetDataCount=function(a){this.dataCount=a};OV.GltfBufferReader.prototype.SetSparseReader=function(a,b){this.sparseReader={indexReader:a,valueReader:b}};OV.GltfBufferReader.prototype.ReadArrayBuffer=function(a){return this.reader.ReadArrayBuffer(a)};OV.GltfBufferReader.prototype.GetDataCount=function(){return this.dataCount};
OV.GltfBufferReader.prototype.ReadData=function(){if(null===this.dataType)return null;if(this.dataType===OV.GltfDataType.SCALAR){var a=this.ReadComponent();this.SkipBytesByStride(1);return a}if(this.dataType===OV.GltfDataType.VEC2){a=this.ReadComponent();var b=this.ReadComponent();this.SkipBytesByStride(2);return new OV.Coord2D(a,b)}if(this.dataType===OV.GltfDataType.VEC3){a=this.ReadComponent();b=this.ReadComponent();var c=this.ReadComponent();this.SkipBytesByStride(3);return new OV.Coord3D(a,b,
c)}return null};OV.GltfBufferReader.prototype.EnumerateData=function(a){if(null===this.sparseReader)for(var b=0;b<this.dataCount;b++)a(this.ReadData());else{b=[];for(var c=0;c<this.sparseReader.indexReader.GetDataCount();c++){var d=this.sparseReader.indexReader.ReadData(),e=this.sparseReader.valueReader.ReadData();b.push({index:d,value:e})}for(d=c=0;d<this.dataCount;d++)e=this.ReadData(),c<b.length&&b[c].index===d?(a(b[c].value),c+=1):a(e)}};OV.GltfBufferReader.prototype.SkipBytes=function(a){this.reader.Skip(a)};
OV.GltfBufferReader.prototype.ReadComponent=function(){return null===this.componentType?null:this.componentType===OV.GltfComponentType.BYTE?this.reader.ReadCharacter8():this.componentType===OV.GltfComponentType.UNSIGNED_BYTE?this.reader.ReadUnsignedCharacter8():this.componentType===OV.GltfComponentType.SHORT?this.reader.ReadInteger16():this.componentType===OV.GltfComponentType.UNSIGNED_SHORT?this.reader.ReadUnsignedInteger16():this.componentType===OV.GltfComponentType.UNSIGNED_INT?this.reader.ReadInteger32():
this.componentType===OV.GltfComponentType.FLOAT?this.reader.ReadFloat32():null};OV.GltfBufferReader.prototype.SkipBytesByStride=function(a){null!==this.byteStride&&(a*=this.GetComponentSize(),this.reader.Skip(this.byteStride-a))};
OV.GltfBufferReader.prototype.GetComponentSize=function(){return this.componentType===OV.GltfComponentType.BYTE||this.componentType===OV.GltfComponentType.UNSIGNED_BYTE?1:this.componentType===OV.GltfComponentType.SHORT||this.componentType===OV.GltfComponentType.UNSIGNED_SHORT?2:this.componentType===OV.GltfComponentType.UNSIGNED_INT||this.componentType===OV.GltfComponentType.FLOAT?4:0};OV.GltfExtensions=function(){this.supportedExtensions=["KHR_materials_pbrSpecularGlossiness","KHR_texture_transform"]};
OV.GltfExtensions.prototype.GetUnsupportedExtensions=function(a){var b=[];if(void 0===a)return b;for(var c=0;c<a.length;c++){var d=a[c];-1===this.supportedExtensions.indexOf(d)&&b.push(d)}return b};
OV.GltfExtensions.prototype.ProcessMaterial=function(a,b,c){function d(f){return parseInt(Math.round(255*OV.LinearToSRGB(f)),10)}if(void 0!==a.extensions&&(a=a.extensions.KHR_materials_pbrSpecularGlossiness,void 0!==a)){var e=a.diffuseFactor;void 0!==e&&(b.diffuse=new OV.Color(d(e[0]),d(e[1]),d(e[2])),b.opacity=e[3]);e=a.diffuseTexture;void 0!==e&&(b.diffuseMap=c(e));e=a.specularFactor;void 0!==e&&(b.specular=new OV.Color(d(e[0]),d(e[1]),d(e[2])));e=a.specularGlossinessTexture;void 0!==e&&(b.specularMap=
c(e));c=a.glossinessFactor;void 0!==c&&(b.shininess=c)}};OV.GltfExtensions.prototype.ProcessTexture=function(a,b){void 0!==a.extensions&&(a=a.extensions.KHR_texture_transform,void 0!==a&&(void 0!==a.offset&&(b.offset.x=a.offset[0],b.offset.y=-a.offset[1]),void 0!==a.scale&&(b.scale.x=a.scale[0],b.scale.y=a.scale[1]),void 0!==a.rotation&&(b.rotation=-a.rotation)))};OV.ImporterGltf=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterGltf,OV.ImporterBase);
OV.ImporterGltf.prototype.CanImportExtension=function(a){return"gltf"===a||"glb"===a};OV.ImporterGltf.prototype.GetKnownFileFormats=function(){return{gltf:OV.FileFormat.Text,glb:OV.FileFormat.Binary,bin:OV.FileFormat.Binary}};OV.ImporterGltf.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterGltf.prototype.ClearContent=function(){this.imageIndexToTextureParams=this.gltfExtensions=this.bufferContents=null};
OV.ImporterGltf.prototype.ResetContent=function(){this.bufferContents=[];this.gltfExtensions=new OV.GltfExtensions;this.imageIndexToTextureParams={}};OV.ImporterGltf.prototype.ImportContent=function(a,b){"gltf"===this.extension?this.ProcessGltf(a):"glb"===this.extension&&this.ProcessBinaryGltf(a);b()};
OV.ImporterGltf.prototype.ProcessGltf=function(a){a=JSON.parse(a);if("2.0"!==a.asset.version)this.SetError(),this.SetMessage("Invalid glTF version.");else{for(var b=0;b<a.buffers.length;b++){var c=null,d=a.buffers[b],e=OV.Base64DataURIToArrayBuffer(d.uri);null!==e?c=e.buffer:(d=this.callbacks.getFileBuffer(d.uri),null!==d&&(c=d));if(null===c){this.SetError();this.SetMessage("One  of the requested buffers is missing.");return}this.bufferContents.push(c)}this.ProcessMainFile(a)}};
OV.ImporterGltf.prototype.ProcessBinaryGltf=function(a){a=new OV.BinaryReader(a,!0);if(a.ReadUnsignedInteger32()!==OV.GltfConstants.GLTF_STRING)this.SetError(),this.SetMessage("Invalid glTF file.");else if(2!==a.ReadUnsignedInteger32())this.SetError(),this.SetMessage("Invalid glTF version.");else if(a.ReadUnsignedInteger32()!==a.GetByteLength())this.SetError(),this.SetMessage("Invalid glTF file.");else{for(var b=null;!a.End();){var c=a;var d=c.ReadUnsignedInteger32();var e=c.ReadUnsignedInteger32();
c=c.ReadArrayBuffer(d);e===OV.GltfConstants.JSON_CHUNK_TYPE?b=OV.ArrayBufferToUtf8String(c):e===OV.GltfConstants.BINARY_CHUNK_TYPE&&this.bufferContents.push(c)}null!==b&&(a=JSON.parse(b),this.ProcessMainFile(a))}};
OV.ImporterGltf.prototype.ProcessMainFile=function(a){var b=this.gltfExtensions.GetUnsupportedExtensions(a.extensionsRequired);if(0<b.length)this.SetError(),this.SetMessage("Unsupported extension: "+b.join(", ")+".");else if(b=this.GetDefaultScene(a),null===b)this.SetError(),this.SetMessage("No default scene found.");else{var c=a.materials;if(void 0!==c)for(var d=0;d<c.length;d++)this.ImportMaterial(a,d);b=this.CollectMeshNodesForScene(a,b);for(c=0;c<b.nodes.length;c++)this.ImportMeshNode(a,b.nodes[c],
b)}};OV.ImporterGltf.prototype.GetDefaultScene=function(a){var b=a.scene||0;return b>=a.scenes.length?null:a.scenes[b]};OV.ImporterGltf.prototype.CollectMeshNodesForScene=function(a,b){function c(g,h,k,l,m){var n=g.nodes[k];void 0!==n.mesh&&(l.AddMeshNode(k),m.push(k));l.AddNodeParent(k,h);if(void 0!==n.children)for(h=0;h<n.children.length;h++)c(g,k,n.children[h],l,m)}for(var d=new OV.GltfNodeTree,e=[],f=0;f<b.nodes.length;f++)c(a,-1,b.nodes[f],d,e);return d};
OV.ImporterGltf.prototype.ImportMaterial=function(a,b){function c(g){return parseInt(Math.round(255*OV.LinearToSRGB(g)),10)}b=a.materials[b];var d=new OV.Material;void 0!==b.name&&(d.name=b.name);d.diffuse=new OV.Color(c(1),c(1),c(1));if(void 0!==b.pbrMetallicRoughness){var e=b.pbrMetallicRoughness.baseColorFactor;void 0!==e&&(d.diffuse=new OV.Color(c(e[0]),c(e[1]),c(e[2])),d.opacity=e[3]);e=b.emissiveFactor;void 0!==e&&(d.emissive=new OV.Color(c(e[0]),c(e[1]),c(e[2])));d.diffuseMap=this.ImportTexture(a,
b.pbrMetallicRoughness.baseColorTexture);d.normalMap=this.ImportTexture(a,b.normalTexture);d.emissiveMap=this.ImportTexture(a,b.emissiveTexture);null!==d.diffuseMap&&(d.multiplyDiffuseMap=!0);e=b.alphaMode;void 0!==e&&("BLEND"===e?d.transparent=!0:"MASK"===e&&(d.transparent=!0,d.alphaTest=b.alphaCutoff||.5))}var f=this;this.gltfExtensions.ProcessMaterial(b,d,function(g){return f.ImportTexture(a,g)});this.model.AddMaterial(d)};
OV.ImporterGltf.prototype.ImportTexture=function(a,b){function c(l){if(void 0===l||null===l)return"";l=l.split("/");return 0===l.length?"":"."+l[l.length-1]}if(void 0===b||null===b)return null;var d=new OV.TextureMap,e=a.textures[b.index].source,f=a.images[e],g=this.imageIndexToTextureParams[e];if(void 0===g){g={name:null,url:null,buffer:null};var h=e.toString();if(void 0!==f.uri)a=OV.Base64DataURIToArrayBuffer(f.uri),null!==a?(g.name="Embedded_"+h+c(a.mimeType),g.url=OV.CreateObjectUrlWithMimeType(a.buffer,
a.mimeType),g.buffer=a.buffer):(h=this.callbacks.getTextureBuffer(f.uri),g.name=f.uri,null!==h&&(g.url=h.url,g.buffer=h.buffer));else if(void 0!==f.bufferView){a=a.bufferViews[f.bufferView];var k=this.GetReaderFromBufferView(a);null!==k&&(a=k.ReadArrayBuffer(a.byteLength),g.name="Binary_"+h+c(f.mimeType),g.url=OV.CreateObjectUrlWithMimeType(a,f.mimeType),g.buffer=a)}this.imageIndexToTextureParams[e]=g}d.name=g.name;d.url=g.url;d.buffer=g.buffer;this.gltfExtensions.ProcessTexture(b,d);return d};
OV.ImporterGltf.prototype.ImportMeshNode=function(a,b,c){function d(h,k,l){var m=h.nodes[k],n=l.GetNodeMatrix(k);if(null!==n)return n;n=(new OV.Matrix).CreateIdentity();if(void 0!==m.matrix)n.Set(m.matrix);else{var q=!1,p=[0,0,0],r=[0,0,0,1],t=[1,1,1];void 0!==m.translation&&(p=m.translation,q=!0);void 0!==m.rotation&&(r=m.rotation,q=!0);void 0!==m.scale&&(t=m.scale,q=!0);q&&n.ComposeTRS(p,r,t)}m=l.GetNodeParent(k);null!==m&&(h=d(h,m,l),n=n.MultiplyMatrix(h));l.AddNodeMatrix(k,n);return n}var e=a.meshes[a.nodes[b].mesh],
f=new OV.Mesh;this.model.AddMesh(f);void 0!==e.name&&f.SetName(e.name);for(var g=0;g<e.primitives.length;g++)this.ImportPrimitive(a,e.primitives[g],f);a=d(a,b,c);a=new OV.Transformation(a);OV.TransformMesh(f,a)};
OV.ImporterGltf.prototype.ImportPrimitive=function(a,b,c){function d(r,t,w,v,u,y,x,B,z){x=new OV.Triangle(x+t,x+w,x+v);u&&x.SetNormals(B+t,B+w,B+v);y&&x.SetTextureUVs(z+t,z+w,z+v);void 0!==b.material&&(x.mat=b.material);r.AddTriangle(x)}if(void 0!==b.attributes){var e=void 0!==b.attributes.POSITION,f=void 0!==b.attributes.NORMAL,g=void 0!==b.attributes.TEXCOORD_0,h=void 0!==b.indices,k=OV.GltfRenderMode.TRIANGLES;void 0!==b.mode&&(k=b.mode);if(k===OV.GltfRenderMode.TRIANGLES||k===OV.GltfRenderMode.TRIANGLE_STRIP||
k===OV.GltfRenderMode.TRIANGLE_FAN){var l=c.VertexCount(),m=c.NormalCount(),n=c.TextureUVCount();if(e&&(e=this.GetReaderFromAccessor(a,a.accessors[b.attributes.POSITION]),null!==e)){e.EnumerateData(function(r){c.AddVertex(r)});if(f){e=this.GetReaderFromAccessor(a,a.accessors[b.attributes.NORMAL]);if(null===e)return;e.EnumerateData(function(r){c.AddNormal(r)})}if(g){e=this.GetReaderFromAccessor(a,a.accessors[b.attributes.TEXCOORD_0]);if(null===e)return;e.EnumerateData(function(r){r.y=-r.y;c.AddTextureUV(r)})}var q=
[];if(h){a=this.GetReaderFromAccessor(a,a.accessors[b.indices]);if(null===a)return;a.EnumerateData(function(r){q.push(r)})}else for(a=0;a<c.VertexCount();a++)q.push(a);if(k===OV.GltfRenderMode.TRIANGLES)for(k=0;k<q.length;k+=3)d(c,q[k],q[k+1],q[k+2],f,g,l,m,n);else if(k===OV.GltfRenderMode.TRIANGLE_STRIP)for(k=0;k<q.length-2;k++){a=q[k];h=q[k+1];e=q[k+2];if(1===k%2){var p=h;h=e;e=p}d(c,a,h,e,f,g,l,m,n)}else if(k===OV.GltfRenderMode.TRIANGLE_FAN)for(k=1;k<q.length-1;k++)d(c,q[0],q[k],q[k+1],f,g,l,
m,n)}}}};OV.ImporterGltf.prototype.GetReaderFromBufferView=function(a){var b=this.bufferContents[a.buffer||0];if(null===b)return null;b=new OV.GltfBufferReader(b);b.SkipBytes(a.byteOffset||0);a=a.byteStride;void 0!==a&&0!==a&&b.SetByteStride(a);return b};
OV.ImporterGltf.prototype.GetReaderFromAccessor=function(a,b){var c=this.GetReaderFromBufferView(a.bufferViews[b.bufferView||0]);if(null===c)return null;c.SetComponentType(b.componentType);c.SetDataType(b.type);c.SetDataCount(b.count);c.SkipBytes(b.byteOffset||0);if(void 0!==b.sparse){var d=this.GetReaderFromSparseAccessor(a,b.sparse.indices,b.sparse.indices.componentType,"SCALAR",b.sparse.count);a=this.GetReaderFromSparseAccessor(a,b.sparse.values,b.componentType,b.type,b.sparse.count);null!==d&&
null!==a&&c.SetSparseReader(d,a)}return c};OV.ImporterGltf.prototype.GetReaderFromSparseAccessor=function(a,b,c,d,e){if(void 0===b.bufferView)return null;a=this.GetReaderFromBufferView(a.bufferViews[b.bufferView]);if(null===a)return null;a.SetComponentType(c);a.SetDataType(d);a.SetDataCount(e);a.SkipBytes(b.byteOffset||0);return a};OV.File=function(a,b){this.source=b;b===OV.FileSource.Url?(this.fileUrl=a,this.fileObject=null,this.name=OV.GetFileName(a),this.extension=OV.GetFileExtension(a)):b===OV.FileSource.File&&(this.fileUrl=null,this.fileObject=a,this.name=OV.GetFileName(a.name),this.extension=OV.GetFileExtension(a.name));this.content=null};OV.FileList=function(a){this.files=[];this.importers=a};OV.FileList.prototype.FillFromFileUrls=function(a){this.Fill(a,OV.FileSource.Url)};
OV.FileList.prototype.FillFromFileObjects=function(a){this.Fill(a,OV.FileSource.File)};OV.FileList.prototype.ExtendFromFileList=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.ContainsFileByPath(c.name)||this.files.push(c)}};OV.FileList.prototype.GetFiles=function(){return this.files};OV.FileList.prototype.GetContent=function(a){var b=this;(new OV.TaskRunner).Run(this.files.length,{runTask:function(c,d){b.GetFileContent(b.files[c],d)},onReady:a})};
OV.FileList.prototype.ContainsFileByPath=function(a){return null!==this.FindFileByPath(a)};OV.FileList.prototype.FindFileByPath=function(a){a=OV.GetFileName(a).toLowerCase();for(var b=0;b<this.files.length;b++){var c=this.files[b];if(c.name.toLowerCase()===a)return c}return null};OV.FileList.prototype.HasMainFile=function(){return null!==this.GetMainFile()};
OV.FileList.prototype.GetMainFile=function(){for(var a=0;a<this.files.length;a++){var b=this.files[a],c=this.FindImporter(b);if(null!==c)return{file:b,importer:c}}return null};OV.FileList.prototype.IsOnlySource=function(a){if(0===this.files.length)return!1;for(var b=0;b<this.files.length;b++)if(this.files[b].source!==a)return!1;return!0};OV.FileList.prototype.Fill=function(a,b){this.files=[];for(var c=0;c<a.length;c++){var d=new OV.File(a[c],b);this.AddFile(d)}};OV.FileList.prototype.AddFile=function(a){this.files.push(a)};
OV.FileList.prototype.GetFileContent=function(a,b){var c={success:function(e){a.content=e},error:function(){},complete:function(){b()}};if(null!==a.content)b();else{var d=this.GetFileFormat(a);a.source===OV.FileSource.Url?OV.RequestUrl(a.fileUrl,d,c):a.source===OV.FileSource.File&&OV.ReadFile(a.fileObject,d,c)}};OV.FileList.prototype.GetFileFormat=function(a){for(var b=0;b<this.importers.length;b++){var c=this.importers[b],d=a.extension.toLowerCase();c=c.GetKnownFileFormats();if(void 0!==c[d])return c[d]}return OV.FileFormat.Binary};
OV.FileList.prototype.FindImporter=function(a){for(var b=0;b<this.importers.length;b++){var c=this.importers[b];if(c.CanImportExtension(a.extension.toLowerCase()))return c}return null};OV.ImportSettings=function(){this.defaultColor=new OV.Color(200,200,200)};OV.ImportErrorCode={NoImportableFile:1,ImportFailed:2,UnknownError:3};OV.ImportError=function(a,b){this.code=a;this.message=b};OV.ImportResult=function(){this.missingFiles=this.usedFiles=this.upVector=this.mainFile=this.model=null};
OV.ImportBuffers=function(a){this.getBufferCallback=a;this.fileBuffers={};this.textureBuffers={}};OV.ImportBuffers.prototype.GetFileBuffer=function(a){a=OV.GetFileName(a);var b=this.fileBuffers[a];void 0===b&&(b=this.getBufferCallback(a),this.fileBuffers[a]=b);return b};OV.ImportBuffers.prototype.GetTextureBuffer=function(a){a=OV.GetFileName(a);var b=this.textureBuffers[a];void 0===b&&(b=this.getBufferCallback(a),b=null!==b?{url:OV.CreateObjectUrl(b),buffer:b}:null,this.textureBuffers[a]=b);return b};
OV.Importer=function(){this.importers=[new OV.ImporterObj,new OV.ImporterStl,new OV.ImporterOff,new OV.ImporterPly,new OV.Importer3ds,new OV.ImporterGltf];this.fileList=new OV.FileList(this.importers);this.model=null;this.usedFiles=[];this.missingFiles=[]};OV.Importer.prototype.AddImporter=function(a){this.importers.push(a)};OV.Importer.prototype.LoadFilesFromUrls=function(a,b){this.LoadFiles(a,OV.FileSource.Url,b)};
OV.Importer.prototype.LoadFilesFromFileObjects=function(a,b){this.LoadFiles(a,OV.FileSource.File,b)};
OV.Importer.prototype.Import=function(a,b){var c=this.fileList.GetMainFile();if(null===c||null===c.file||null===c.file.content)b.onError(new OV.ImportError(OV.ImportErrorCode.NoImportableFile,null));else{this.RevokeModelUrls();this.model=null;this.usedFiles=[];this.missingFiles=[];this.usedFiles.push(c.file.name);var d=this,e=c.importer,f=new OV.ImportBuffers(function(g){var h=d.fileList.FindFileByPath(g);null===h||null===h.content?(d.missingFiles.push(g),h=null):(h=h.content,d.usedFiles.push(g));
return h});e.Import(c.file.content,c.file.extension,{getDefaultMaterial:function(){var g=new OV.Material;g.diffuse=a.defaultColor;return g},getFileBuffer:function(g){return f.GetFileBuffer(g)},getTextureBuffer:function(g){return f.GetTextureBuffer(g)},onSuccess:function(){d.model=e.GetModel();d.model.SetName(c.file.name);var g=new OV.ImportResult;g.mainFile=c.file.name;g.model=d.model;g.usedFiles=d.usedFiles;g.missingFiles=d.missingFiles;g.upVector=e.GetUpDirection();b.onSuccess(g)},onError:function(){var g=
e.GetMessage();b.onError(new OV.ImportError(OV.ImportErrorCode.ImportFailed,g))},onComplete:function(){e.Clear()}})}};
OV.Importer.prototype.LoadFiles=function(a,b,c){var d=new OV.FileList(this.importers);b===OV.FileSource.Url?d.FillFromFileUrls(a):b===OV.FileSource.File&&d.FillFromFileObjects(a);a=!1;if(d.HasMainFile())a=!0;else{a=!1;for(b=0;b<this.missingFiles.length;b++)d.ContainsFileByPath(this.missingFiles[b])&&(a=!0);a?(a=d.GetFiles(),this.fileList.ExtendFromFileList(a),a=!1):a=!0}a&&(this.fileList=d);this.fileList.GetContent(function(){c()})};OV.Importer.prototype.GetFileList=function(){return this.fileList};
OV.Importer.prototype.IsOnlyFileSource=function(a){return this.fileList.IsOnlySource(a)};OV.Importer.prototype.RevokeModelUrls=function(){if(null!==this.model)for(var a=0;a<this.model.MaterialCount();a++)this.model.GetMaterial(a).EnumerateTextureMaps(function(b){null!==b.url&&OV.RevokeObjectUrl(b.url)})};OV.EnumerateModelVerticesAndTriangles=function(a,b){for(var c=0;c<a.MeshCount();c++)for(var d=a.GetMesh(c),e=0;e<d.VertexCount();e++){var f=d.GetVertex(e);b.onVertex(f.x,f.y,f.z)}for(d=c=0;d<a.MeshCount();d++){e=a.GetMesh(d);for(f=0;f<e.TriangleCount();f++){var g=e.GetTriangle(f);b.onTriangle(g.v0+c,g.v1+c,g.v2+c)}c+=e.VertexCount()}};
OV.EnumerateModelTrianglesWithNormals=function(a,b){for(var c=0;c<a.MeshCount();c++)for(var d=a.GetMesh(c),e=0;e<d.TriangleCount();e++){var f=d.GetTriangle(e),g=d.GetVertex(f.v0),h=d.GetVertex(f.v1);f=d.GetVertex(f.v2);var k=OV.CalculateTriangleNormal(g,h,f);b(g,h,f,k)}};OV.ExportedFile=function(a){this.name=a;this.content=null};OV.ExportedFile.prototype.GetName=function(){return this.name};OV.ExportedFile.prototype.SetName=function(a){this.name=a};OV.ExportedFile.prototype.GetContent=function(){return this.content};OV.ExportedFile.prototype.SetContent=function(a){this.content=a};OV.ExporterBase=function(){};OV.ExporterBase.prototype.CanExport=function(a,b){return!1};OV.ExporterBase.prototype.Export=function(a,b,c){var d=[];this.ExportContent(a,b,d,function(){c(d)})};
OV.ExporterBase.prototype.ExportContent=function(a,b,c,d){};OV.ExporterBase.prototype.GetExportedMaterialName=function(a){return this.GetExportedName(a,"Material")};OV.ExporterBase.prototype.GetExportedMeshName=function(a){return this.GetExportedName(a,"Mesh")};OV.ExporterBase.prototype.GetExportedName=function(a,b){return 0===a.length?b:a};OV.ExporterObj=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterObj,OV.ExporterBase);OV.ExporterObj.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"obj"===b};
OV.ExporterObj.prototype.ExportContent=function(a,b,c,d){function e(z,A,C,E){if(null!==C&&C.IsValid()){var D=OV.GetFileName(C.name);z.WriteArrayLine([A,D]);-1===E.findIndex(function(G){return G.GetName()===D})&&(z=new OV.ExportedFile(D),z.SetContent(C.buffer),E.push(z))}}var f=new OV.ExportedFile("model.mtl");b=new OV.ExportedFile("model.obj");c.push(f);c.push(b);var g=new OV.TextWriter;g.WriteLine(this.GetHeaderText());for(var h=0;h<a.MaterialCount();h++){var k=a.GetMaterial(h);g.WriteArrayLine(["newmtl",
this.GetExportedMaterialName(k.name)]);g.WriteArrayLine(["Ka",k.ambient.r/255,k.ambient.g/255,k.ambient.b/255]);g.WriteArrayLine(["Kd",k.diffuse.r/255,k.diffuse.g/255,k.diffuse.b/255]);g.WriteArrayLine(["Ks",k.specular.r/255,k.specular.g/255,k.specular.b/255]);g.WriteArrayLine(["Ns",1E3*k.shininess]);g.WriteArrayLine(["d",k.opacity]);e(g,"map_Kd",k.diffuseMap,c);e(g,"map_Ks",k.specularMap,c);e(g,"bump",k.bumpMap,c)}f.SetContent(g.GetText());c=new OV.TextWriter;c.WriteLine(this.GetHeaderText());c.WriteArrayLine(["mtllib",
f.GetName()]);h=g=f=0;k=null;for(var l=0;l<a.MeshCount();l++){var m=a.GetMesh(l);c.WriteArrayLine(["g",this.GetExportedMeshName(m.GetName())]);for(var n=0;n<m.VertexCount();n++){var q=m.GetVertex(n);c.WriteArrayLine(["v",q.x,q.y,q.z])}for(n=0;n<m.NormalCount();n++)q=m.GetNormal(n),c.WriteArrayLine(["vn",q.x,q.y,q.z]);for(n=0;n<m.TextureUVCount();n++)q=m.GetTextureUV(n),c.WriteArrayLine(["vt",q.x,q.y]);for(n=0;n<m.TriangleCount();n++){q=m.GetTriangle(n);var p=q.v0+f+1,r=q.v1+f+1,t=q.v2+f+1,w=q.n0+
g+1,v=q.n1+g+1,u=q.n2+g+1;if(null!==q.mat){var y=a.GetMaterial(q.mat);y=this.GetExportedMaterialName(y.name);y!==k&&(c.WriteArrayLine(["usemtl",y]),k=y)}var x=y="",B="";q.HasTextureUVs()&&(y=q.u0+h+1,x=q.u1+h+1,B=q.u2+h+1);c.WriteArrayLine(["f",[p,y,w].join("/"),[r,x,v].join("/"),[t,B,u].join("/")])}f+=m.VertexCount();g+=m.NormalCount();h+=m.TextureUVCount()}b.SetContent(c.GetText());d()};OV.ExporterObj.prototype.GetHeaderText=function(){return"# exported by https://3dviewer.net"};OV.ExporterStl=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterStl,OV.ExporterBase);OV.ExporterStl.prototype.CanExport=function(a,b){return(a===OV.FileFormat.Text||a===OV.FileFormat.Binary)&&"stl"===b};OV.ExporterStl.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportText(a,c):this.ExportBinary(a,c);d()};
OV.ExporterStl.prototype.ExportText=function(a,b){var c=new OV.ExportedFile("model.stl");b.push(c);var d=new OV.TextWriter;d.WriteLine("solid Model");OV.EnumerateModelTrianglesWithNormals(a,function(e,f,g,h){d.WriteArrayLine(["facet","normal",h.x,h.y,h.z]);d.Indent(1);d.WriteLine("outer loop");d.Indent(1);d.WriteArrayLine(["vertex",e.x,e.y,e.z]);d.WriteArrayLine(["vertex",f.x,f.y,f.z]);d.WriteArrayLine(["vertex",g.x,g.y,g.z]);d.Indent(-1);d.WriteLine("endloop");d.Indent(-1);d.WriteLine("endfacet")});
d.WriteLine("endsolid Model");c.SetContent(d.GetText())};
OV.ExporterStl.prototype.ExportBinary=function(a,b){var c=new OV.ExportedFile("model.stl");b.push(c);b=a.TriangleCount();for(var d=new OV.BinaryWriter(84+50*b,!0),e=0;80>e;e++)d.WriteUnsignedCharacter8(0);d.WriteUnsignedInteger32(b);OV.EnumerateModelTrianglesWithNormals(a,function(f,g,h,k){d.WriteFloat32(k.x);d.WriteFloat32(k.y);d.WriteFloat32(k.z);d.WriteFloat32(f.x);d.WriteFloat32(f.y);d.WriteFloat32(f.z);d.WriteFloat32(g.x);d.WriteFloat32(g.y);d.WriteFloat32(g.z);d.WriteFloat32(h.x);d.WriteFloat32(h.y);
d.WriteFloat32(h.z);d.WriteUnsignedInteger16(0)});c.SetContent(d.GetBuffer())};OV.ExporterPly=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterPly,OV.ExporterBase);OV.ExporterPly.prototype.CanExport=function(a,b){return(a===OV.FileFormat.Text||a===OV.FileFormat.Binary)&&"ply"===b};OV.ExporterPly.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportText(a,c):this.ExportBinary(a,c);d()};
OV.ExporterPly.prototype.ExportText=function(a,b){var c=new OV.ExportedFile("model.ply");b.push(c);var d=new OV.TextWriter;b=a.VertexCount();var e=a.TriangleCount();b=this.GetHeaderText("ascii",b,e);d.Write(b);OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(f,g,h){d.WriteArrayLine([f,g,h])},onTriangle:function(f,g,h){d.WriteArrayLine([3,f,g,h])}});c.SetContent(d.GetText())};
OV.ExporterPly.prototype.ExportBinary=function(a,b){var c=new OV.ExportedFile("model.ply");b.push(c);var d=a.VertexCount(),e=a.TriangleCount();b=this.GetHeaderText("binary_little_endian",d,e);var f=new OV.BinaryWriter(b.length+12*d+13*e,!0);for(d=0;d<b.length;d++)f.WriteUnsignedCharacter8(b.charCodeAt(d));OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(g,h,k){f.WriteFloat32(g);f.WriteFloat32(h);f.WriteFloat32(k)},onTriangle:function(g,h,k){f.WriteUnsignedCharacter8(3);f.WriteInteger32(g);
f.WriteInteger32(h);f.WriteInteger32(k)}});c.SetContent(f.GetBuffer())};OV.ExporterPly.prototype.GetHeaderText=function(a,b,c){var d=new OV.TextWriter;d.WriteLine("ply");d.WriteLine("format "+a+" 1.0");d.WriteLine("element vertex "+b);d.WriteLine("property float x");d.WriteLine("property float y");d.WriteLine("property float z");d.WriteLine("element face "+c);d.WriteLine("property list uchar int vertex_index");d.WriteLine("end_header");return d.GetText()};OV.ExporterOff=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterOff,OV.ExporterBase);OV.ExporterOff.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"off"===b};
OV.ExporterOff.prototype.ExportContent=function(a,b,c,d){b=new OV.ExportedFile("model.off");c.push(b);var e=new OV.TextWriter;e.WriteLine("OFF");e.WriteArrayLine([a.VertexCount(),a.TriangleCount(),0]);OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(f,g,h){e.WriteArrayLine([f,g,h])},onTriangle:function(f,g,h){e.WriteArrayLine([3,f,g,h])}});b.SetContent(e.GetText());d()};OV.ExporterGltf=function(){OV.ExporterBase.call(this);this.components={index:{type:5125,size:4},number:{type:5126,size:4}}};$jscomp.inherits(OV.ExporterGltf,OV.ExporterBase);OV.ExporterGltf.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"gltf"===b||a===OV.FileFormat.Binary&&"glb"===b};OV.ExporterGltf.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportAsciiContent(a,c):b===OV.FileFormat.Binary&&this.ExportBinaryContent(a,c);d()};
OV.ExporterGltf.prototype.ExportAsciiContent=function(a,b){var c=new OV.ExportedFile("model.gltf"),d=new OV.ExportedFile("model.bin");b.push(c);b.push(d);var e=this.GetMeshData(a),f=this.GetMainBuffer(e),g=this.GetMainJson(e);g.buffers.push({uri:d.GetName(),byteLength:f.byteLength});var h=[];this.ExportMaterials(a,g,function(k){var l=OV.GetFileName(k.name),m=h[l];void 0===m&&(m=new OV.ExportedFile(l),m.SetContent(k.buffer),b.push(m),m=g.textures.length,h[l]=m,g.images.push({uri:l}),g.textures.push({source:m}));
return m});c.SetContent(JSON.stringify(g,null,4));d.SetContent(f)};
OV.ExporterGltf.prototype.ExportBinaryContent=function(a,b){function c(t){var w=t%4;return 0===w?t:t+(4-w)}function d(t,w,v){for(var u=0;u<v;u++)t.WriteUnsignedCharacter8(w)}var e=new OV.ExportedFile("model.glb");b.push(e);var f=this.GetMeshData(a);b=this.GetMainBuffer(f);var g=this.GetMainJson(f),h=[],k=b.byteLength,l=[];this.ExportMaterials(a,g,function(t){var w=OV.GetFileName(t.name),v=OV.GetFileExtension(t.name),u=l[w];if(void 0===u){var y=g.bufferViews.length;u=g.textures.length;l[w]=u;t=t.buffer;
h.push(t);g.bufferViews.push({buffer:0,byteOffset:k,byteLength:t.byteLength});k+=t.byteLength;g.images.push({bufferView:y,mimeType:"image/"+v});g.textures.push({source:u})}return u});a=b.byteLength;for(f=0;f<h.length;f++)a+=h[f].byteLength;f=c(a);g.buffers.push({byteLength:f});var m=JSON.stringify(g),n=OV.Utf8StringToArrayBuffer(m),q=n.byteLength,p=c(q),r=20+p+8+f;m=new OV.BinaryWriter(r,!0);m.WriteUnsignedInteger32(1179937895);m.WriteUnsignedInteger32(2);m.WriteUnsignedInteger32(r);m.WriteUnsignedInteger32(p);
m.WriteUnsignedInteger32(1313821514);m.WriteArrayBuffer(n);d(m,32,p-q);m.WriteUnsignedInteger32(f);m.WriteUnsignedInteger32(5130562);m.WriteArrayBuffer(b);for(b=0;b<h.length;b++)m.WriteArrayBuffer(h[b]);d(m,0,f-a);e.SetContent(m.GetBuffer())};OV.ExporterGltf.prototype.GetMeshData=function(a){for(var b=[],c=0;c<a.MeshCount();c++){var d=a.GetMesh(c),e=OV.ConvertMeshToMeshBuffer(d);b.push({name:d.GetName(),buffer:e,offsets:[],sizes:[]})}return b};
OV.ExporterGltf.prototype.GetMainBuffer=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].buffer.GetByteLength(this.components.index.size,this.components.number.size);b=new OV.BinaryWriter(b,!0);for(c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.buffer.PrimitiveCount();e++){for(var f=d.buffer.GetPrimitive(e),g=b.GetPosition(),h=0;h<f.indices.length;h++)b.WriteUnsignedInteger32(f.indices[h]);for(h=0;h<f.vertices.length;h++)b.WriteFloat32(f.vertices[h]);for(h=0;h<f.normals.length;h++)b.WriteFloat32(f.normals[h]);
for(h=0;h<f.uvs.length;h++){var k=f.uvs[h];1===h%2&&(k*=-1);b.WriteFloat32(k)}d.offsets.push(g);d.sizes.push(b.GetPosition()-g)}return b.GetBuffer()};
OV.ExporterGltf.prototype.GetMainJson=function(a){var b=function(r,t){this.mainJson=r;this.byteOffset=t};b.prototype.AddBufferView=function(r){this.mainJson.bufferViews.push({buffer:0,byteOffset:this.byteOffset,byteLength:r});this.byteOffset+=r};for(var c={asset:{version:"2.0",generator:"https://3dviewer.net"},scene:0,scenes:[{nodes:[]}],nodes:[],materials:[],meshes:[],buffers:[],bufferViews:[],accessors:[]},d=0;d<a.length;d++){var e=a[d];c.scenes[0].nodes.push(d);c.nodes.push({mesh:d});for(var f=
{name:this.GetExportedMeshName(e.name),primitives:[]},g=e.buffer.primitives,h=0;h<g.length;h++){var k=g[h],l=c.bufferViews.length,m=new b(c,e.offsets[h]);m.AddBufferView(k.indices.length*this.components.index.size);m.AddBufferView(k.vertices.length*this.components.number.size);m.AddBufferView(k.normals.length*this.components.number.size);var n=c.accessors.length,q={attributes:{POSITION:n+1,NORMAL:n+2},indices:n,mode:4,material:k.material},p=k.GetBounds();c.accessors.push({bufferView:l,byteOffset:0,
componentType:this.components.index.type,count:k.indices.length,type:"SCALAR"});c.accessors.push({bufferView:l+1,byteOffset:0,componentType:this.components.number.type,count:k.vertices.length/3,min:p.min,max:p.max,type:"VEC3"});c.accessors.push({bufferView:l+2,byteOffset:0,componentType:this.components.number.type,count:k.normals.length/3,type:"VEC3"});0<k.uvs.length&&(m.AddBufferView(k.uvs.length*this.components.number.size),c.accessors.push({bufferView:l+3,byteOffset:0,componentType:this.components.number.type,
count:k.uvs.length/2,type:"VEC2"}),q.attributes.TEXCOORD_0=n+3);f.primitives.push(q)}c.meshes.push(f)}return c};
OV.ExporterGltf.prototype.ExportMaterials=function(a,b,c){function d(g,h,k,l){function m(p,r){return[OV.SRGBToLinear(p.r/255),OV.SRGBToLinear(p.g/255),OV.SRGBToLinear(p.b/255),r]}function n(p,r,t){if(null===r||!r.IsValid())return null;void 0===p.images&&(p.images=[]);void 0===p.textures&&(p.textures=[]);t={index:t(r)};r.HasTransformation()&&(void 0===p.extensionsUsed&&(p.extensionsUsed=[]),-1===p.extensionsUsed.indexOf("KHR_texture_transform")&&p.extensionsUsed.push("KHR_texture_transform"),t.extensions=
{KHR_texture_transform:{offset:[r.offset.x,-r.offset.y],scale:[r.scale.x,r.scale.y],rotation:-r.rotation}});return t}g={name:g.GetExportedMaterialName(k.name),pbrMetallicRoughness:{baseColorFactor:m(k.diffuse,k.opacity),metallicFactor:0,roughnessFactor:1},emissiveFactor:function(p){return[OV.SRGBToLinear(p.r/255),OV.SRGBToLinear(p.g/255),OV.SRGBToLinear(p.b/255)]}(k.emissive),doubleSided:!0,alphaMode:"OPAQUE"};k.transparent&&(g.alphaMode="BLEND");var q=n(h,k.diffuseMap,l);null!==q&&(k.multiplyDiffuseMap||
(g.pbrMetallicRoughness.baseColorFactor=m(new OV.Color(255,255,255),k.opacity)),g.pbrMetallicRoughness.baseColorTexture=q);q=n(h,k.normalMap,l);null!==q&&(g.normalTexture=q);k=n(h,k.emissiveMap,l);null!==k&&(g.emissiveTexture=k);h.materials.push(g)}for(var e=0;e<a.MaterialCount();e++){var f=a.GetMaterial(e);d(this,b,f,c)}};OV.Exporter=function(){this.exporters=[new OV.ExporterObj,new OV.ExporterStl,new OV.ExporterPly,new OV.ExporterOff,new OV.ExporterGltf]};OV.Exporter.prototype.AddExporter=function(a){this.exporters.push(a)};OV.Exporter.prototype.Export=function(a,b,c,d){for(var e=null,f=0;f<this.exporters.length;f++){var g=this.exporters[f];if(g.CanExport(b,c)){e=g;break}}if(null===e)d.onError();else e.Export(a,b,function(h){if(0===h.length)d.onError();else d.onSuccess(h)})};OV.Importer3dm=function(){OV.ImporterBase.call(this);this.rhino=null};$jscomp.inherits(OV.Importer3dm,OV.ImporterBase);OV.Importer3dm.prototype.CanImportExtension=function(a){return"3dm"===a};OV.Importer3dm.prototype.GetKnownFileFormats=function(){return{"3dm":OV.FileFormat.Binary}};OV.Importer3dm.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.Importer3dm.prototype.ClearContent=function(){this.instanceDefinitions=this.instanceObjects=null};
OV.Importer3dm.prototype.ResetContent=function(){this.instanceObjects={};this.instanceDefinitions={}};OV.Importer3dm.prototype.ImportContent=function(a,b){if(null===this.rhino){var c=this;rhino3dm().then(function(d){c.rhino=d;c.ImportRhinoContent(a);b()})}else this.ImportRhinoContent(a),b()};
OV.Importer3dm.prototype.ImportRhinoContent=function(a){a=this.rhino.File3dm.fromByteArray(a);null===a?(this.SetError(),this.SetMessage("Failed to read Rhino file.")):(this.ImportRhinoDocument(a),OV.IsModelEmpty(this.model)&&(this.SetError(),this.SetMessage("The model doesn't contain any 3D meshes. Try to save the model while you are in shaded view in Rhino.")))};OV.Importer3dm.prototype.ImportRhinoDocument=function(a){this.InitRhinoInstances(a);this.ImportRhinoGeometry(a)};
OV.Importer3dm.prototype.InitRhinoInstances=function(a){for(var b=a.objects(),c=0;c<b.count;c++){var d=b.get(c),e=d.attributes();e.isInstanceDefinitionObject&&(this.instanceObjects[e.id]=d)}a=a.instanceDefinitions();for(b=0;b<a.count();b++)c=a.get(b),this.instanceDefinitions[c.id]=c};OV.Importer3dm.prototype.ImportRhinoGeometry=function(a){for(var b=a.objects(),c=0;c<b.count;c++){var d=b.get(c);this.ImportRhinoGeometryObject(a,d,[])}};
OV.Importer3dm.prototype.ImportRhinoGeometryObject=function(a,b,c){var d=b.geometry(),e=b.attributes(),f=d.objectType;if(!e.isInstanceDefinitionObject||0!==c.length){e=null;var g=!1;if(f===this.rhino.ObjectType.Mesh)e=d,g=!1;else if(f===this.rhino.ObjectType.Extrusion)e=d.getMesh(this.rhino.MeshType.Any),g=!0;else if(f===this.rhino.ObjectType.Brep){e=new this.rhino.Mesh;g=d.faces();for(d=0;d<g.count;d++){f=g.get(d);var h=f.getMesh(this.rhino.MeshType.Any);h&&(e.append(h),h.delete());f.delete()}g.delete();
e.compact();g=!0}else if(f===this.rhino.ObjectType.SubD)d.subdivide(3),e=this.rhino.Mesh.createFromSubDControlNet(d),g=!0;else if(f===this.rhino.ObjectType.InstanceReference&&(d=this.instanceDefinitions[d.parentIdefId],void 0!==d))for(d=d.getObjectIds(),f=0;f<d.length;f++)h=this.instanceObjects[d[f]],void 0!==h&&(c.push(b),this.ImportRhinoGeometryObject(a,h,c),c.pop());null!==e&&(this.ImportRhinoMesh(a,e,b,c),g&&e.delete())}};
OV.Importer3dm.prototype.ImportRhinoMesh=function(a,b,c,d){var e=c.attributes(),f=new OV.Mesh;f.SetName(e.name);a=this.GetMaterialIndex(a,c,d);e=b.toThreejsJSON();b=e.data.attributes.position.array;for(c=0;c<b.length;c+=3)f.AddVertex(new OV.Coord3D(b[c],b[c+1],b[c+2]));if(b=void 0!==e.data.attributes.normal){c=e.data.attributes.normal.array;for(var g=0;g<c.length;g+=3)f.AddNormal(new OV.Coord3D(c[g],c[g+1],c[g+2]))}if(c=void 0!==e.data.attributes.uv){g=e.data.attributes.uv.array;for(var h=0;h<g.length;h+=
2)f.AddTextureUV(new OV.Coord2D(g[h],g[h+1]))}e=e.data.index.array;for(g=0;g<e.length;g+=3){h=e[g];var k=e[g+1],l=e[g+2],m=new OV.Triangle(h,k,l);b&&m.SetNormals(h,k,l);c&&m.SetTextureUVs(h,k,l);null!==a&&m.SetMaterial(a);f.AddTriangle(m)}if(0!==d.length){a=(new OV.Matrix).CreateIdentity();for(b=d.length-1;0<=b;b--)c=d[b].geometry().xform.toFloatArray(!1),c=new OV.Matrix(c),a=a.MultiplyMatrix(c);d=new OV.Transformation(a);OV.TransformMesh(f,d)}this.model.AddMesh(f)};
OV.Importer3dm.prototype.GetMaterialIndex=function(a,b,c){function d(e,f,g){f=f.attributes();if(f.materialSource===e.ObjectMaterialSource.MaterialFromObject){if(e=f.materialIndex,-1<e)return a.materials().get(e)}else if(f.materialSource===e.ObjectMaterialSource.MaterialFromLayer){if(e=f.layerIndex,0<e&&(e=a.layers().get(e).renderMaterialIndex,-1<e))return a.materials().get(e)}else if(f.materialSource===e.ObjectMaterialSource.MaterialFromParent&&0!==g.length)return d(e,g[0],[]);return null}b=d(this.rhino,
b,c);return function(e,f){function g(n,q){n.Set(q.r,q.g,q.b)}function h(n){return 0===n.r&&0===n.g&&0===n.b}function k(n){return 255===n.r&&255===n.g&&255===n.b}var l=new OV.Material;null===f?l.diffuse.Set(255,255,255):(l.name=f.name,g(l.ambient,f.ambientColor),g(l.diffuse,f.diffuseColor),g(l.specular,f.specularColor),l.opacity=1-f.transparency,l.transparent=OV.IsLower(l.opacity,1),h(l.diffuse)&&!k(f.reflectionColor)&&g(l.diffuse,f.reflectionColor),h(l.diffuse)&&!k(f.transparentColor)&&g(l.diffuse,
f.transparentColor));for(f=0;f<e.MaterialCount();f++){var m=e.GetMaterial(f);if(m.name===l.name&&OV.ColorIsEqual(m.ambient,l.ambient)&&OV.ColorIsEqual(m.diffuse,l.diffuse)&&OV.ColorIsEqual(m.specular,l.specular)&&OV.IsEqual(m.opacity,l.opacity)&&m.transparent===l.transparent&&OV.IsEqual(m.shininess,l.shininess))return f}return e.AddMaterial(l)}(this.model,b)};OV.Exporter3dm=function(){OV.ExporterBase.call(this);this.rhino=null};$jscomp.inherits(OV.Exporter3dm,OV.ExporterBase);OV.Exporter3dm.prototype.CanExport=function(a,b){return a===OV.FileFormat.Binary&&"3dm"===b};OV.Exporter3dm.prototype.ExportContent=function(a,b,c,d){if(null===this.rhino){var e=this;rhino3dm().then(function(f){e.rhino=f;e.ExportRhinoContent(a,c,d)})}else this.ExportRhinoContent(a,c,d)};
OV.Exporter3dm.prototype.ExportRhinoContent=function(a,b,c){function d(q){return{r:q.r,g:q.g,b:q.b,a:255}}var e=new OV.ExportedFile("model.3dm");b.push(e);b=new this.rhino.File3dm;for(var f=0;f<a.MeshCount();f++)for(var g=a.GetMesh(f),h=OV.ConvertMeshToMeshBuffer(g),k=0;k<h.PrimitiveCount();k++){var l=h.GetPrimitive(k),m={data:{attributes:{position:{itemSize:3,type:"Float32Array",array:l.vertices},normal:{itemSize:3,type:"Float32Array",array:l.normals}},index:{type:"Uint16Array",array:l.indices}}};
l=a.GetMaterial(l.material);var n=new this.rhino.Material;n.name=this.GetExportedMaterialName(l.name);n.ambientColor=d(l.ambient);n.diffuseColor=d(l.diffuse);n.specularColor=d(l.specular);n.transparency=1-l.opacity;l=b.materials().count();b.materials().add(n);m=new this.rhino.Mesh.createFromThreejsJSON(m);n=new this.rhino.ObjectAttributes;n.name=this.GetExportedMeshName(g.GetName());n.materialSource=this.rhino.ObjectMaterialSource.MaterialFromObject;n.materialIndex=l;b.objects().add(m,n)}a=new this.rhino.File3dmWriteOptions;
a.version=6;a=b.toByteArray(a);e.SetContent(a);c()};OV.ConvertModelToThreeMeshes=function(a,b){function c(k,l){function m(r,t,w){null!==t&&t.IsValid()&&(new THREE.TextureLoader).load(t.url,function(v){v.wrapS=THREE.RepeatWrapping;v.wrapT=THREE.RepeatWrapping;v.rotation=t.rotation;v.offset.x=t.offset.x;v.offset.y=t.offset.y;v.repeat.x=t.scale.x;v.repeat.y=t.scale.y;v.image=OV.ResizeImageToPowerOfTwoSides(v.image);r.needsUpdate=!0;w(v)})}var n=k.GetMaterial(l);k=new THREE.Color(n.diffuse.r/255,n.diffuse.g/255,n.diffuse.b/255);l=new THREE.Color(n.specular.r/
255,n.specular.g/255,n.specular.b/255);var q=new THREE.Color(n.emissive.r/255,n.emissive.g/255,n.emissive.b/255);OV.IsEqual(n.shininess,0)&&l.setRGB(0,0,0);var p=new THREE.MeshPhongMaterial({color:k,specular:l,emissive:q,shininess:100*n.shininess,opacity:n.opacity,transparent:n.transparent,alphaTest:n.alphaTest,side:THREE.DoubleSide});m(p,n.diffuseMap,function(r){n.multiplyDiffuseMap||p.color.setRGB(1,1,1);p.map=r;b.onTextureLoaded()});m(p,n.specularMap,function(r){p.specularMap=r;b.onTextureLoaded()});
m(p,n.bumpMap,function(r){p.bumpMap=r;b.onTextureLoaded()});m(p,n.normalMap,function(r){p.normalMap=r;b.onTextureLoaded()});m(p,n.emissiveMap,function(r){p.emissiveMap=r;b.onTextureLoaded()});return p}function d(k,l,m){var n=k.GetMesh(l),q=n.TriangleCount();if(0===q)return null;var p=[];for(k=0;k<q;k++)p.push(k);p.sort(function(G,F){G=n.GetTriangle(G);F=n.GetTriangle(F);return G.mat-F.mat});var r=new THREE.BufferGeometry,t=[];k=[];var w={},v=[],u=[],y=[],x=[];x.push({start:0,end:-1});for(var B=0<
n.TextureUVCount(),z=0;z<p.length;z++){var A=n.GetTriangle(p[z]),C=n.GetVertex(A.v0),E=n.GetVertex(A.v1),D=n.GetVertex(A.v2);v.push(C.x,C.y,C.z,E.x,E.y,E.z,D.x,D.y,D.z);C=n.GetNormal(A.n0);E=n.GetNormal(A.n1);D=n.GetNormal(A.n2);u.push(C.x,C.y,C.z,E.x,E.y,E.z,D.x,D.y,D.z);A.HasTextureUVs()?(C=n.GetTextureUV(A.u0),E=n.GetTextureUV(A.u1),D=n.GetTextureUV(A.u2),y.push(C.x,C.y,E.x,E.y,D.x,D.y)):B&&y.push(0,0,0,0,0,0);A=A.mat;C=w[A];void 0===C&&(C=t.length,w[A]=C,t.push(m[A]),k.push(A),0<z&&(x[x.length-
1].end=z-1,x.push({start:x[x.length-1].end+1,end:-1})))}x[x.length-1].end=q-1;r.setAttribute("position",new THREE.Float32BufferAttribute(v,3));r.setAttribute("normal",new THREE.Float32BufferAttribute(u,3));0!==y.length&&r.setAttribute("uv",new THREE.Float32BufferAttribute(y,2));for(m=0;m<x.length;m++)q=x[m],r.addGroup(3*q.start,3*(q.end-q.start+1),m);m=new THREE.Mesh(r,t);m.userData={originalMeshIndex:l,originalMaterials:k,threeMaterials:null};return m}for(var e=[],f=0;f<a.MaterialCount();f++){var g=
c(a,f);e.push(g)}var h=[];(new OV.TaskRunner).Run(a.MeshCount(),{runTask:function(k,l){0!==a.GetMesh(k).TriangleCount()&&(k=d(a,k,e),h.push(k));l()},onReady:function(){b.onModelLoaded(h)}})};OV.ThreeModelLoader=function(){this.importer=new OV.Importer;this.importer.AddImporter(new OV.Importer3dm);this.callbacks=null;this.inProgress=!1};OV.ThreeModelLoader.prototype.Init=function(a){this.callbacks=a};OV.ThreeModelLoader.prototype.LoadFromUrlList=function(a,b){if(!this.inProgress){var c=this;this.inProgress=!0;this.callbacks.onLoadStart();this.importer.LoadFilesFromUrls(a,function(){c.OnFilesLoaded(b)})}};
OV.ThreeModelLoader.prototype.LoadFromFileList=function(a,b){if(!this.inProgress){var c=this;this.inProgress=!0;this.callbacks.onLoadStart();this.importer.LoadFilesFromFileObjects(a,function(){c.OnFilesLoaded(b)})}};OV.ThreeModelLoader.prototype.ReloadFiles=function(a){this.inProgress||(this.inProgress=!0,this.callbacks.onLoadStart(),this.OnFilesLoaded(a))};
OV.ThreeModelLoader.prototype.OnFilesLoaded=function(a){var b=this;this.callbacks.onImportStart();OV.RunTaskAsync(function(){b.importer.Import(a,{onSuccess:function(c){b.OnModelImported(c)},onError:function(c){b.callbacks.onLoadError(c);b.inProgress=!1}})})};
OV.ThreeModelLoader.prototype.OnModelImported=function(a){var b=this;this.callbacks.onVisualizationStart();OV.ConvertModelToThreeMeshes(a.model,{onTextureLoaded:function(){b.callbacks.onTextureLoaded()},onModelLoaded:function(c){b.callbacks.onModelFinished(a,c);b.inProgress=!1}})};OV.ThreeModelLoader.prototype.GetImporter=function(){return this.importer};OV.ParameterConverter={IntegerToString:function(a){return a.toString()},StringToInteger:function(a){return parseInt(a,10)},NumberToString:function(a){return a.toPrecision(5)},StringToNumber:function(a){return parseFloat(a)},ModelUrlsToString:function(a){return null===a?null:a.join(",")},StringToModelUrls:function(a){return null===a||0===a.length?null:a.split(",")},CameraToString:function(a){return null===a?null:[this.NumberToString(a.eye.x),this.NumberToString(a.eye.y),this.NumberToString(a.eye.z),
this.NumberToString(a.center.x),this.NumberToString(a.center.y),this.NumberToString(a.center.z),this.NumberToString(a.up.x),this.NumberToString(a.up.y),this.NumberToString(a.up.z)].join()},StringToCamera:function(a){if(null===a||0===a.length)return null;a=a.split(",");return 9!==a.length?null:new OV.Camera(new OV.Coord3D(this.StringToNumber(a[0]),this.StringToNumber(a[1]),this.StringToNumber(a[2])),new OV.Coord3D(this.StringToNumber(a[3]),this.StringToNumber(a[4]),this.StringToNumber(a[5])),new OV.Coord3D(this.StringToNumber(a[6]),
this.StringToNumber(a[7]),this.StringToNumber(a[8])))},ColorToString:function(a){return null===a?null:[this.IntegerToString(a.r),this.IntegerToString(a.g),this.IntegerToString(a.b)].join()},StringToColor:function(a){if(null===a||0===a.length)return null;a=a.split(",");return 3!==a.length?null:new OV.Color(this.StringToInteger(a[0]),this.StringToInteger(a[1]),this.StringToInteger(a[2]))}};OV.ParameterListBuilder=function(a){this.separator=a;this.paramList=""};
OV.ParameterListBuilder.prototype.AddModelUrls=function(a){this.AddUrlPart("model",OV.ParameterConverter.ModelUrlsToString(a));return this};OV.ParameterListBuilder.prototype.AddCamera=function(a){this.AddUrlPart("camera",OV.ParameterConverter.CameraToString(a));return this};OV.ParameterListBuilder.prototype.AddColor=function(a){this.AddUrlPart("color",OV.ParameterConverter.ColorToString(a));return this};
OV.ParameterListBuilder.prototype.AddUrlPart=function(a,b){null!==a&&null!==b&&(0<this.paramList.length&&(this.paramList+=this.separator),this.paramList+=a+"="+b)};OV.ParameterListBuilder.prototype.GetParameterList=function(){return this.paramList};OV.ParameterListParser=function(a,b){this.separator=b;this.paramList=a};OV.ParameterListParser.prototype.GetModelUrls=function(){if(-1===this.paramList.indexOf("="))return this.paramList.split(",");var a=this.GetKeywordParams("model");return OV.ParameterConverter.StringToModelUrls(a)};
OV.ParameterListParser.prototype.GetCamera=function(){var a=this.GetKeywordParams("camera");return OV.ParameterConverter.StringToCamera(a)};OV.ParameterListParser.prototype.GetColor=function(){var a=this.GetKeywordParams("color");return OV.ParameterConverter.StringToColor(a)};OV.ParameterListParser.prototype.GetKeywordParams=function(a){if(null===this.paramList||0===this.paramList.length)return null;a+="=";for(var b=this.paramList.split(this.separator),c=0;c<b.length;c++){var d=b[c];if(d.startsWith(a))return d.substr(a.length)}return null};
OV.CreateUrlBuilder=function(){return new OV.ParameterListBuilder("$")};OV.CreateUrlParser=function(a){return new OV.ParameterListParser(a,"$")};OV.CreateModelUrlParameters=function(a){var b=OV.CreateUrlBuilder();b.AddModelUrls(a);return b.GetParameterList()};OV.GetInnerDimensions=function(a,b,c){function d(e){return Math.round(parseFloat(e))}a=getComputedStyle(a);b=b-d(a.borderLeftWidth)-d(a.borderRightWidth)-d(a.marginLeft)-d(a.marginRight)-d(a.paddingLeft)-d(a.paddingRight);c=c-d(a.borderTopWidth)-d(a.borderBottomWidth)-d(a.marginTop)-d(a.marginBottom)-d(a.paddingTop)-d(a.paddingBottom);return{width:b,height:c}};OV.GetClientCoordinates=function(a,b,c){a.getBoundingClientRect&&(a=a.getBoundingClientRect(),b-=a.left,c-=a.top);window.pageXOffset&&window.pageYOffset&&(b+=window.pageXOffset,c+=window.pageYOffset);return new OV.Coord2D(b,c)};OV.Camera=function(a,b,c){this.eye=a;this.center=b;this.up=c};OV.Camera.prototype.Clone=function(){return new OV.Camera(this.eye.Clone(),this.center.Clone(),this.up.Clone())};
OV.MouseInteraction=function(){this.prev=new OV.Coord2D(0,0);this.curr=new OV.Coord2D(0,0,0);this.diff=new OV.Coord2D(0,0);this.buttons=[]};OV.MouseInteraction.prototype.Down=function(a,b){this.buttons.push(b.which);this.curr=this.GetCurrent(a,b);this.prev=this.curr.Clone()};OV.MouseInteraction.prototype.Move=function(a,b){this.curr=this.GetCurrent(a,b);this.diff=OV.SubCoord2D(this.curr,this.prev);this.prev=this.curr.Clone()};
OV.MouseInteraction.prototype.Up=function(a,b){var c=this.buttons.indexOf(b.which);-1!==c&&this.buttons.splice(c,1);this.curr=this.GetCurrent(a,b)};OV.MouseInteraction.prototype.Leave=function(a,b){this.buttons=[];this.curr=this.GetCurrent(a,b)};OV.MouseInteraction.prototype.IsButtonDown=function(){return 0<this.buttons.length};OV.MouseInteraction.prototype.GetButton=function(){var a=this.buttons.length;return 0===a?0:this.buttons[a-1]};OV.MouseInteraction.prototype.GetMoveDiff=function(){return this.diff};
OV.MouseInteraction.prototype.GetCurrent=function(a,b){return OV.GetClientCoordinates(a,b.clientX,b.clientY)};OV.TouchInteraction=function(){this.prevPos=new OV.Coord2D(0,0);this.currPos=new OV.Coord2D(0,0,0);this.diffPos=new OV.Coord2D(0,0);this.fingers=this.diffDist=this.currDist=this.prevDist=0};
OV.TouchInteraction.prototype.Start=function(a,b){0!==b.touches.length&&(this.fingers=b.touches.length,this.currPos=this.GetCurrent(a,b),this.prevPos=this.currPos.Clone(),this.prevDist=this.currDist=this.GetTouchDistance(a,b))};
OV.TouchInteraction.prototype.Move=function(a,b){0!==b.touches.length&&(this.currPos=this.GetCurrent(a,b),this.diffPos=OV.SubCoord2D(this.currPos,this.prevPos),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistance(a,b),this.diffDist=this.currDist-this.prevDist,this.prevDist=this.currDist)};OV.TouchInteraction.prototype.End=function(a,b){0!==b.touches.length&&(this.fingers=0,this.currPos=this.GetCurrent(a,b),this.currDist=this.GetTouchDistance(a,b))};
OV.TouchInteraction.prototype.IsFingerDown=function(){return 0!==this.fingers};OV.TouchInteraction.prototype.GetFingerCount=function(){return this.fingers};OV.TouchInteraction.prototype.GetMoveDiff=function(){return this.diffPos};OV.TouchInteraction.prototype.GetDistanceDiff=function(){return this.diffDist};OV.TouchInteraction.prototype.GetCurrent=function(a,b){var c=null;0!==b.touches.length&&(b=b.touches[0],c=OV.GetClientCoordinates(a,b.pageX,b.pageY));return c};
OV.TouchInteraction.prototype.GetTouchDistance=function(a,b){if(2!==b.touches.length)return 0;var c=b.touches[0];b=b.touches[1];return OV.CoordDistance2D(OV.GetClientCoordinates(a,c.pageX,c.pageY),OV.GetClientCoordinates(a,b.pageX,b.pageY))};OV.ClickDetector=function(){this.isClick=!1;this.button=0};OV.ClickDetector.prototype.Down=function(a){this.isClick=!0;this.button=a.which};OV.ClickDetector.prototype.Move=function(){this.isClick=!1};
OV.ClickDetector.prototype.Up=function(a){this.isClick&&a.which!==this.button&&(this.isClick=!1)};OV.ClickDetector.prototype.Leave=function(a){this.isClick=!1;this.button=0};OV.ClickDetector.prototype.IsClick=function(){return this.isClick};
OV.Navigation=function(a,b){this.canvas=a;this.camera=b;this.orbitCenter=this.camera.center.Clone();this.fixUpVector=!0;this.mouse=new OV.MouseInteraction;this.touch=new OV.TouchInteraction;this.clickDetector=new OV.ClickDetector;this.onClick=this.onUpdate=null;this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",this.OnMouseDown.bind(this)),this.canvas.addEventListener("DOMMouseScroll",this.OnMouseWheel.bind(this)),this.canvas.addEventListener("mousewheel",this.OnMouseWheel.bind(this)),
this.canvas.addEventListener("touchstart",this.OnTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.OnTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("contextmenu",this.OnContextMenu.bind(this)));document.addEventListener&&(document.addEventListener("mousemove",this.OnMouseMove.bind(this)),document.addEventListener("mouseup",this.OnMouseUp.bind(this)),document.addEventListener("mouseleave",this.OnMouseLeave.bind(this)))};
OV.Navigation.prototype.SetUpdateHandler=function(a){this.onUpdate=a};OV.Navigation.prototype.SetClickHandler=function(a){this.onClick=a};OV.Navigation.prototype.IsFixUpVector=function(){return this.fixUpVector};OV.Navigation.prototype.SetFixUpVector=function(a){this.fixUpVector=a};OV.Navigation.prototype.GetCamera=function(){return this.camera};OV.Navigation.prototype.SetCamera=function(a){this.camera=a};
OV.Navigation.prototype.MoveCamera=function(a,b){function c(g,h,k,l){g.camera.eye=h.eye[l];g.camera.center=h.center[l];g.camera.up=h.up[l];g.Update();l<k-1&&requestAnimationFrame(function(){c(g,h,k,l+1)})}if(null!==a)if(0===b)this.SetCamera(a);else if(!(OV.CoordIsEqual3D(this.camera.eye,a.eye)&&OV.CoordIsEqual3D(this.camera.center,a.center)&&OV.CoordIsEqual3D(this.camera.up,a.up))){var d=OV.ParabolicTweenFunction,e=this,f={eye:OV.TweenCoord3D(this.camera.eye,a.eye,b,d),center:OV.TweenCoord3D(this.camera.center,
a.center,b,d),up:OV.TweenCoord3D(this.camera.up,a.up,b,d)};requestAnimationFrame(function(){c(e,f,b,0)});this.Update()}};OV.Navigation.prototype.FitToSphere=function(a,b,c){OV.IsZero(b)||(this.camera=this.GetFitToSphereCamera(a,b,c),this.orbitCenter=this.camera.center.Clone(),this.Update())};
OV.Navigation.prototype.GetFitToSphereCamera=function(a,b,c){if(OV.IsZero(b))return null;var d=this.camera.Clone(),e=OV.SubCoord3D(d.center,a);d.eye=OV.SubCoord3D(d.eye,e);d.center=a.Clone();a=OV.SubCoord3D(d.eye,d.center).Normalize();c/=2;this.canvas.width<this.canvas.height&&(c=c*this.canvas.width/this.canvas.height);b/=Math.sin(c*OV.DegRad);d.eye=d.center.Clone().Offset(a,b);this.orbitCenter=d.center.Clone();return d};
OV.Navigation.prototype.OnMouseDown=function(a){a.preventDefault();this.mouse.Down(this.canvas,a);this.clickDetector.Down(a)};OV.Navigation.prototype.OnMouseMove=function(a){this.mouse.Move(this.canvas,a);this.clickDetector.Move();if(this.mouse.IsButtonDown()){a=this.mouse.GetMoveDiff();var b=this.mouse.GetButton();if(1===b)this.Orbit(.5*a.x,.5*a.y);else if(2===b||3===b)b=.001*OV.CoordDistance3D(this.camera.eye,this.camera.center),this.Pan(a.x*b,a.y*b);this.Update()}};
OV.Navigation.prototype.OnMouseUp=function(a){this.mouse.Up(this.canvas,a);this.clickDetector.Up(a);this.clickDetector.IsClick()&&this.Click(a.which,a.ctrlKey||a.metaKey,a.clientX,a.clientY)};OV.Navigation.prototype.OnMouseLeave=function(a){this.mouse.Leave(this.canvas,a);this.clickDetector.Leave(a)};OV.Navigation.prototype.OnTouchStart=function(a){a.preventDefault();this.touch.Start(this.canvas,a)};
OV.Navigation.prototype.OnTouchMove=function(a){a.preventDefault();this.touch.Move(this.canvas,a);if(this.touch.IsFingerDown()){a=this.touch.GetMoveDiff();var b=this.touch.GetDistanceDiff(),c=this.touch.GetFingerCount();1===c?this.Orbit(.5*a.x,.5*a.y):2===c&&(this.Zoom(.005*b),b=.001*OV.CoordDistance3D(this.camera.eye,this.camera.center),this.Pan(a.x*b,a.y*b));this.Update()}};OV.Navigation.prototype.OnTouchEnd=function(a){a.preventDefault();this.touch.End(this.canvas,a)};
OV.Navigation.prototype.OnMouseWheel=function(a){a.preventDefault();var b=a||window.event;a=0;b.detail?a=-b.detail:b.wheelDelta&&(a=b.wheelDelta/40);b=.1;0>a&&(b*=-1);this.Zoom(b);this.Update()};OV.Navigation.prototype.OnContextMenu=function(a){a.preventDefault()};
OV.Navigation.prototype.Orbit=function(a,b){a*=OV.DegRad;b*=OV.DegRad;var c=OV.SubCoord3D(this.camera.center,this.camera.eye).Normalize(),d=OV.CrossVector3D(c,this.camera.up).Normalize(),e=!OV.CoordIsEqual3D(this.orbitCenter,this.camera.center);this.fixUpVector?(c=OV.VectorAngle3D(c,this.camera.up)+b,OV.IsGreater(c,0)&&OV.IsLower(c,Math.PI)&&(this.camera.eye.Rotate(d,-b,this.orbitCenter),e&&this.camera.center.Rotate(d,-b,this.orbitCenter)),this.camera.eye.Rotate(this.camera.up,-a,this.orbitCenter),
e&&this.camera.center.Rotate(this.camera.up,-a,this.orbitCenter)):(c=OV.CrossVector3D(d,c).Normalize(),this.camera.eye.Rotate(d,-b,this.orbitCenter),this.camera.eye.Rotate(c,-a,this.orbitCenter),e&&(this.camera.center.Rotate(d,-b,this.orbitCenter),this.camera.center.Rotate(c,-a,this.orbitCenter)),this.camera.up=c)};
OV.Navigation.prototype.Pan=function(a,b){var c=OV.SubCoord3D(this.camera.center,this.camera.eye).Normalize(),d=OV.CrossVector3D(c,this.camera.up).Normalize();c=OV.CrossVector3D(d,c).Normalize();this.camera.eye.Offset(d,-a);this.camera.center.Offset(d,-a);this.camera.eye.Offset(c,b);this.camera.center.Offset(c,b)};OV.Navigation.prototype.Zoom=function(a){var b=OV.SubCoord3D(this.camera.center,this.camera.eye),c=b.Length();this.camera.eye.Offset(b,c*a)};OV.Navigation.prototype.Update=function(){if(this.onUpdate)this.onUpdate()};
OV.Navigation.prototype.Click=function(a,b,c,d){this.onClick&&(c=OV.GetClientCoordinates(this.canvas,c,d),this.onClick(a,b,c))};OV.GetDefaultCamera=function(a){return a===OV.Direction.X?new OV.Camera(new OV.Coord3D(2,-3,1.5),new OV.Coord3D(0,0,0),new OV.Coord3D(1,0,0)):a===OV.Direction.Y?new OV.Camera(new OV.Coord3D(-1.5,2,3),new OV.Coord3D(0,0,0),new OV.Coord3D(0,1,0)):a===OV.Direction.Z?new OV.Camera(new OV.Coord3D(-1.5,-3,2),new OV.Coord3D(0,0,0),new OV.Coord3D(0,0,1)):null};OV.UpVector=function(){this.direction=OV.Direction.Z;this.isFixed=!0;this.isFlipped=!1};
OV.UpVector.prototype.SetDirection=function(a,b){this.direction=a;this.isFlipped=!1;a=OV.GetDefaultCamera(this.direction);a=OV.SubCoord3D(a.eye,a.center);var c=OV.CoordDistance3D(b.center,b.eye);a=b.center.Clone().Offset(a,c);b=b.Clone();this.direction===OV.Direction.X&&(b.up=new OV.Coord3D(1,0,0),b.eye=a);this.direction===OV.Direction.Y?(b.up=new OV.Coord3D(0,1,0),b.eye=a):this.direction===OV.Direction.Z&&(b.up=new OV.Coord3D(0,0,1),b.eye=a);return b};
OV.UpVector.prototype.SetFixed=function(a,b){return(this.isFixed=a)?this.SetDirection(this.direction,b):null};OV.UpVector.prototype.Flip=function(a){this.isFlipped=!this.isFlipped;a=a.Clone();a.up.MultiplyScalar(-1);return a};OV.ViewerGeometry=function(a){this.scene=a;this.modelMeshes=[]};OV.ViewerGeometry.prototype.AddModelMeshes=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.modelMeshes.push(c);this.scene.add(c)}};OV.ViewerGeometry.prototype.GetModelMeshes=function(){return this.modelMeshes};
OV.ViewerGeometry.prototype.ClearModelMeshes=function(){for(var a=0;a<this.modelMeshes.length;a++){var b=this.modelMeshes[a];b.geometry.dispose();this.scene.remove(b)}this.modelMeshes=[]};OV.ViewerGeometry.prototype.EnumerateModelMeshes=function(a){for(var b=0;b<this.modelMeshes.length;b++)a(this.modelMeshes[b])};
OV.ViewerGeometry.prototype.GetModelMeshUnderMouse=function(a,b,c,d){var e=new THREE.Raycaster,f=new THREE.Vector2;f.x=a.x/c*2-1;f.y=2*-(a.y/d)+1;e.setFromCamera(f,b);a=e.intersectObjects(this.modelMeshes);for(b=0;b<a.length;b++)if(c=a[b],"Mesh"===c.object.type&&c.object.visible)return c.object;return null};OV.Viewer=function(){this.upVector=this.navigation=this.light=this.camera=this.geometry=this.scene=this.renderer=this.canvas=null;this.settings={animationSteps:40}};
OV.Viewer.prototype.Init=function(a){this.canvas=a;this.canvas.id="viewer";this.canvas.addEventListener("contenxtmenu",function(b){b.preventDefault()});this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0});window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setClearColor("#ffffff",1);this.renderer.setSize(this.canvas.width,this.canvas.height);this.scene=new THREE.Scene;this.geometry=new OV.ViewerGeometry(this.scene);this.InitCamera();this.InitLights();
this.Render()};OV.Viewer.prototype.SetClickHandler=function(a){this.navigation.SetClickHandler(a)};OV.Viewer.prototype.GetCamera=function(){return this.navigation.GetCamera()};OV.Viewer.prototype.SetCamera=function(a){this.navigation.SetCamera(a);this.Render()};OV.Viewer.prototype.Resize=function(a,b){a=OV.GetInnerDimensions(this.canvas,a,b);this.ResizeRenderer(a.width,a.height)};
OV.Viewer.prototype.ResizeRenderer=function(a,b){window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio);this.camera.aspect=a/b;this.camera.updateProjectionMatrix();this.renderer.setSize(a,b);this.Render()};
OV.Viewer.prototype.FitToWindow=function(a,b){if(null!==a){var c=new OV.Coord3D(a.center.x,a.center.y,a.center.z);a=a.radius;var d=this.camera.fov;b?(b=this.navigation.GetFitToSphereCamera(c,a,d),this.navigation.MoveCamera(b,this.settings.animationSteps)):this.navigation.FitToSphere(c,a,d)}};
OV.Viewer.prototype.AdjustClippingPlanes=function(a){null!==a&&(10>a.radius?(this.camera.near=.01,this.camera.far=100):100>a.radius?(this.camera.near=.1,this.camera.far=1E3):1E3>a.radius?(this.camera.near=10,this.camera.far=1E4):(this.camera.near=100,this.camera.far=1E6),this.camera.updateProjectionMatrix(),this.Render())};OV.Viewer.prototype.IsFixUpVector=function(){return this.navigation.IsFixUpVector()};
OV.Viewer.prototype.SetFixUpVector=function(a){var b=this.navigation.GetCamera();b=this.upVector.SetFixed(a,b);this.navigation.SetFixUpVector(a);null!==b&&this.navigation.MoveCamera(b,this.settings.animationSteps);this.Render()};OV.Viewer.prototype.SetUpVector=function(a,b){var c=this.navigation.GetCamera();a=this.upVector.SetDirection(a,c);this.navigation.MoveCamera(a,b?this.settings.animationSteps:0);this.Render()};
OV.Viewer.prototype.FlipUpVector=function(){var a=this.navigation.GetCamera();a=this.upVector.Flip(a);this.navigation.MoveCamera(a,0);this.Render()};OV.Viewer.prototype.Render=function(){var a=this.navigation.GetCamera();this.camera.position.set(a.eye.x,a.eye.y,a.eye.z);this.camera.up.set(a.up.x,a.up.y,a.up.z);this.camera.lookAt(new THREE.Vector3(a.center.x,a.center.y,a.center.z));a=OV.SubCoord3D(a.eye,a.center);this.light.position.set(a.x,a.y,a.z);this.renderer.render(this.scene,this.camera)};
OV.Viewer.prototype.AddMeshes=function(a){this.geometry.AddModelMeshes(a);this.Render()};OV.Viewer.prototype.Clear=function(){this.geometry.ClearModelMeshes();this.Render()};OV.Viewer.prototype.SetMeshesVisibility=function(a){this.geometry.EnumerateModelMeshes(function(b){var c=a(b.userData);b.visible!==c&&(b.visible=c)});this.Render()};
OV.Viewer.prototype.SetMeshesHighlight=function(a,b){this.geometry.EnumerateModelMeshes(function(c){if(b(c.userData)){if(null===c.userData.threeMaterials){for(var d=c.userData.threeMaterials=c.material,e=[],f=0;f<d.length;f++)e.push(a);c.material=e}}else null!==c.userData.threeMaterials&&(c.material=c.userData.threeMaterials,c.userData.threeMaterials=null)});this.Render()};
OV.Viewer.prototype.GetMeshUserDataUnderMouse=function(a){var b=this.canvas.width,c=this.canvas.height;window.devicePixelRatio&&(b/=window.devicePixelRatio,c/=window.devicePixelRatio);a=this.geometry.GetModelMeshUnderMouse(a,this.camera,b,c);return null===a?null:a.userData};OV.Viewer.prototype.GetBoundingBox=function(a){var b=!1,c=new THREE.Box3;this.geometry.EnumerateModelMeshes(function(d){a(d.userData)&&(c.union((new THREE.Box3).setFromObject(d)),b=!0)});return b?c:null};
OV.Viewer.prototype.GetBoundingSphere=function(a){a=this.GetBoundingBox(a);if(null===a)return null;var b=new THREE.Sphere;a.getBoundingSphere(b);return b};OV.Viewer.prototype.EnumerateMeshesUserData=function(a){this.geometry.EnumerateModelMeshes(function(b){a(b.userData)})};
OV.Viewer.prototype.InitCamera=function(){this.camera=new THREE.PerspectiveCamera(45,this.canvas.width/this.canvas.height,.1,1E3);this.scene.add(this.camera);var a=this.renderer.domElement,b=OV.GetDefaultCamera(OV.Direction.Z),c=this;this.navigation=new OV.Navigation(a,b);this.navigation.SetUpdateHandler(function(){c.Render()});this.upVector=new OV.UpVector};
OV.Viewer.prototype.InitLights=function(){var a=new THREE.AmbientLight(8947848);this.scene.add(a);this.light=new THREE.DirectionalLight(8947848);this.scene.add(this.light)};OV.Viewer.prototype.GetImageSize=function(){var a=new THREE.Vector2;this.renderer.getSize(a);return{width:parseInt(a.x,10),height:parseInt(a.y,10)}};
OV.Viewer.prototype.GetImageAsDataUrl=function(a,b){var c=this.GetImageSize();window.devicePixelRatio&&(a/=window.devicePixelRatio,b/=window.devicePixelRatio);this.ResizeRenderer(a,b);this.Render();b=this.renderer.domElement.toDataURL();this.ResizeRenderer(c.width,c.height);return b};OV.Init3DViewerElements=function(){function a(c){var d=document.createElement("canvas");c.appendChild(d);var e=new OV.Viewer;e.Init(d);e.Resize(c.clientWidth,c.clientHeight);var f=new OV.ThreeModelLoader,g=null;f.Init({onLoadStart:function(){d.style.display="none";g=document.createElement("div");c.appendChild(g);g.innerHTML="Loading model..."},onImportStart:function(){g.innerHTML="Importing model..."},onVisualizationStart:function(){g.innerHTML="Visualizing model..."},onModelFinished:function(m,n){c.removeChild(g);
d.style.display="inherit";e.AddMeshes(n);n=e.GetBoundingSphere(function(r){return!0});e.AdjustClippingPlanes(n);var q=null,p=c.getAttribute("camera");p&&(q=OV.ParameterConverter.StringToCamera(p));null!==q?e.SetCamera(q):e.SetUpVector(m.upVector,!1);e.FitToWindow(n,!1)},onTextureLoaded:function(){e.Render()},onLoadError:function(m){g.innerHTML="Unknown error."}});var h=c.getAttribute("model");if(h&&(h=OV.ParameterConverter.StringToModelUrls(h),null!==h&&0!==h.length)){var k=new OV.ImportSettings,
l=c.getAttribute("color");l&&(l=OV.ParameterConverter.StringToColor(l),null!==l&&(k.defaultColor=l));f.LoadFromUrlList(h,k);return{element:c,viewer:e}}}var b=[];window.addEventListener("load",function(){for(var c=document.getElementsByClassName("online_3d_viewer"),d=0;d<c.length;d++){var e=a(c[d]);b.push(e)}});window.addEventListener("resize",function(){for(var c=0;c<b.length;c++){var d=b[c];d.viewer.Resize(d.element.clientWidth,d.element.clientHeight)}})};
